


<!DOCTYPE html>
<html lang="en">
  <head><meta name="generator" content="Hexo 3.9.0">
    <title>API ‚Äî Feathers-Plus</title>
    <meta charset="utf-8">
    <meta name="description" content="Feathers-Plus - Bridging FeathersJS and real world apps.">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="alternate" hreflang="x-default" href="https://vuejs.org/v1/feathers-hooks-common/index.html">
    <link rel="alternate" hreflang="zh" href="https://cn.vuejs.org/v1/feathers-hooks-common/index.html">
    <link rel="alternate" hreflang="ja" href="https://jp.vuejs.org/v1/feathers-hooks-common/index.html">
    <link rel="alternate" hreflang="ru" href="https://ru.vuejs.org/v1/feathers-hooks-common/index.html">
    <link rel="alternate" hreflang="ko" href="https://kr.vuejs.org/v1/feathers-hooks-common/index.html">
    <link rel="alternate" hreflang="pt-BR" href="https://br.vuejs.org/v1/feathers-hooks-common/index.html">
    <link rel="alternate" hreflang="fr" href="https://fr.vuejs.org/v1/feathers-hooks-common/index.html">

    <meta property="og:type" content="article">
    <meta property="og:title" content="API ‚Äî Feathers-Plus">
    <meta property="og:description" content="Feathers-Plus - Bridging FeathersJS and real world apps.">
    <meta property="og:image" content="https://feathers-plus.com//images/logo.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="API ‚Äî Feathers-Plus">
    <meta name="twitter:description" content="Feathers-Plus - Bridging FeathersJS and real world apps.">
    <meta name="twitter:image" content="https://feathers-plus.com/images/logo.png">

    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons//apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/icons//apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons//apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons//apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons//apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons//apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons//apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons//apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons//apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/icons//android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/icons//favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/icons//favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/icons//favicon-16x16.png">
    <link rel="manifest" href="/images/icons//manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Dosis:500&text=Vue.js" rel="stylesheet" type="text/css">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- main page styles ------------------------------------------------------------------------->
    <link rel="stylesheet" href="/css/page.css">

    <!-- this needs to be loaded before guide's inline scripts ------------------------------------>
    <script src="/js/client-bundle.js"></script>
    <script>window.PAGE_TYPE = "guide"</script>

    <!-- ga --------------------------------------------------------------------------------------->
    <!--
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-xxxxxxxx-1', 'feathers-plus.com');
      ga('send', 'pageview');
    </script>
    --->
  </head>
  <body class="docs">
    <div id="mobile-bar">
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>

    <!-- top nav bar ------------------------------------------------------------------------------>
    <div id="header">
  <a id="logo" href="/">
    <img src="/images/logo.png">
    <span>Feathers-Plus</span>
  </a>
  <ul id="nav">
    <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input">
  </form>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link current">Extensions</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/v1/feathers-hooks-common/" class="nav-link current">feathers-hooks-common</a></li>
        <li><a href="/v1/authentication-management/" class="nav-link">authentication-management</a></li>
      </ul>
    </li>
    <li><h4>Batch Loader</h4></li>
    <li>
      <ul>
        <li><a href="/v1/batch-loader/" class="nav-link">batch-loader</a></li>
        <li><a href="/v1/cache" class="nav-link">cache</a></li>
      </ul>
    </li>
    <li><h4>Offline First</h4></li>
    <li>
      <ul>
        <li><a href="/v1/offline-snapshot/" class="nav-link">offline-snapshot</a></li>
        <li><a href="/v1/offline-realtime/" class="nav-link">offline-realtime</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Adapters</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/v1/graphql/" class="nav-link">graphql</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container support-vue">
  <a class="nav-link">Frameworks</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="https://vuex.feathersjs.com" target="_blank" class="nav-link">feathers-vuex</a></li>
      </ul>
    </li>
  </ul>
</li>


  </ul>
</div>


    <!-- body ------------------------------------------------------------------------------------->
    
      <div id="main" class="fix-sidebar">
        
          <!--  documentation page ---------------------------------------------------------------->
          
  <div class="sidebar">
  <div class="sidebar-inner">
    <ul class="main-menu">
        <li>
  <form id="search-form">
    <input type="text" id="search-query-sidebar" class="search-query st-default-search-input">
  </form>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link current">Extensions</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/v1/feathers-hooks-common/" class="nav-link current">feathers-hooks-common</a></li>
        <li><a href="/v1/authentication-management/" class="nav-link">authentication-management</a></li>
      </ul>
    </li>
    <li><h4>Batch Loader</h4></li>
    <li>
      <ul>
        <li><a href="/v1/batch-loader/" class="nav-link">batch-loader</a></li>
        <li><a href="/v1/cache" class="nav-link">cache</a></li>
      </ul>
    </li>
    <li><h4>Offline First</h4></li>
    <li>
      <ul>
        <li><a href="/v1/offline-snapshot/" class="nav-link">offline-snapshot</a></li>
        <li><a href="/v1/offline-realtime/" class="nav-link">offline-realtime</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Adapters</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="/v1/graphql/" class="nav-link">graphql</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container support-vue">
  <a class="nav-link">Frameworks</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li>
      <ul>
        <li><a href="https://vuex.feathersjs.com" target="_blank" class="nav-link">feathers-vuex</a></li>
      </ul>
    </li>
  </ul>
</li>


    </ul>
    <div class="list">
      <h3>feathers-hooks-common
        <select class="version-select">
          <option value="SELF" selected>1.0</option>
        </select></h3>
        <ul class="menu-root">
  
    
    <li>
      <a href="/v1/feathers-hooks-common/guide.html" class="sidebar-link">Guide</a>
    </li>
  
    
    <li>
      <a href="/v1/feathers-hooks-common/index.html" class="sidebar-link current">API</a>
    </li>
  
</ul>

    </div>
  </div>
</div>


<div class="content guide with-sidebar index-guide">
  
    

    
  
  
    <h1>API</h1>
  
  <!--=============================================================================================-->
<h1 id="üö®-Docs-have-moved-üö®"><a href="#üö®-Docs-have-moved-üö®" class="headerlink" title="üö® Docs have moved! üö®"></a>üö® Docs have moved! üö®</h1><p>As of version <code>5.0.0</code>, feathers-hooks-common has a new home at <a href="https://hooks-common.feathersjs.com" target="_blank" rel="noopener">https://hooks-common.feathersjs.com</a>.</p>
<p><a href="https://hooks-common.feathersjs.com" target="_blank" rel="noopener">View the new docs</a></p>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>Use feathers-hooks-common v4.x.x with FeathersJS Buzzard.</p>
<p>Use feathers-hooks-common v3.10.0 with FeathersJS Auk. v4.x.x. should also work if you don‚Äôt use callbacks in your hooks.</p><p></p>
<blockquote>
<p>Hooks may be used on the client as well as the server.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install --save feathers-hooks-common</span><br><span class="line"></span><br><span class="line"><span class="comment">// project/src/services/posts/posts.hooks.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; disableMultiItemChange, fastJoin &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> postResolvers = &#123;</span><br><span class="line">  joins: &#123;</span><br><span class="line">    author: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">async</span> post =&gt; post.author = (<span class="keyword">await</span> users.find(&#123; <span class="attr">query</span>: &#123;</span><br><span class="line">      id: post.userId</span><br><span class="line">    &#125; &#125;))[<span class="number">0</span>],</span><br><span class="line">      </span><br><span class="line">    starers: <span class="function"><span class="params">$select</span> =&gt;</span> <span class="keyword">async</span> post =&gt; post.starers = <span class="keyword">await</span> users.find(&#123; <span class="attr">query</span>: &#123;</span><br><span class="line">      id: &#123; <span class="attr">$in</span>: post.starIds &#125;, <span class="attr">$select</span>: $select || [<span class="string">'name'</span>]</span><br><span class="line">    &#125; &#125;),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  before: &#123;</span><br><span class="line">    patch: [ disableMultiItemChange() ],</span><br><span class="line">    remove: [ disableMultiItemChange() ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  after: &#123;</span><br><span class="line">    all: [ fastJoin(postResolvers) ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<!--=============================================================================================-->
<h2 id="Find-Hooks-using-Tags"><a href="#Find-Hooks-using-Tags" class="headerlink" title="Find Hooks using Tags"></a>Find Hooks using Tags</h2><p>  Each Feathers hook and utility function is listed under all the tags relevant to it.</p>
<h3 id="tag-Calling%20services">Calling services</h3><ul>
<li><a href="#callingparams">callingParams</a> - Build <code>params</code> for a service call. Utility function.</li>
<li><a href="#callingparamsdefaults">callingParamsDefaults</a> - Set defaults for building <code>params</code> for service calls with <code>callingParams</code>. Utility function.</li>
<li><a href="#makecallingparams">makeCallingParams</a> - Build <code>context.params</code> for service calls. Utility function.</li>
<li><a href="#paramsforserver">paramsForServer</a> - Pass an explicit <code>context.params</code> from client to server. Client-side. Utility function.</li>
<li><a href="#paramsfromclient">paramsFromClient</a> - Pass <code>context.params</code> from client to server. Server hook.</li></ul><h3 id="tag-Client%2Fserver">Client/server</h3><ul>
<li><a href="#paramsforserver">paramsForServer</a> - Pass an explicit <code>context.params</code> from client to server. Client-side. Utility function.</li>
<li><a href="#paramsfromclient">paramsFromClient</a> - Pass <code>context.params</code> from client to server. Server hook.</li>
<li><a href="#runparallel">runParallel</a> - Run a hook in parallel to the other hooks and the service call.</li></ul><h3 id="tag-Coding">Coding</h3><ul>
<li><a href="#actondefault">actOnDefault</a> - Runs a series of hooks which mutate context.data or content.result (the Feathers default).</li>
<li><a href="#actondispatch">actOnDispatch</a> - Runs a series of hooks which mutate context.dispatch.</li>
<li><a href="#alteritems">alterItems</a> - Make changes to data or result items. Very flexible.</li>
<li><a href="#callingparams">callingParams</a> - Build <code>params</code> for a service call. Utility function.</li>
<li><a href="#callingparamsdefaults">callingParamsDefaults</a> - Set defaults for building <code>params</code> for service calls with <code>callingParams</code>. Utility function.</li>
<li><a href="#checkcontext">checkContext</a> - Restrict a hook to run for certain methods and method types. Utility function.</li>
<li><a href="#combine">combine</a> - Sequentially execute multiple sync or async hooks.</li>
<li><a href="#debug">debug</a> - Display the current hook <code>context</code> for debugging.</li>
<li><a href="#deletebydot">deleteByDot</a> - Deletes a property from an object using dot notation, e.g. <code>address.city</code>. Utility function.</li>
<li><a href="#existsbydot">existsByDot</a> - Check if a property exists in an object by using dot notation, e.g. <code>address.city</code>. Utility function.</li>
<li><a href="#getbydot">getByDot</a> - Return a property value from an object using dot notation, e.g. <code>address.city</code>. Utility function.</li>
<li><a href="#getitems">getItems</a> - Get the records in <code>context.data</code> or <code>context.result[.data]</code>. Utility function.</li>
<li><a href="#makecallingparams">makeCallingParams</a> - Build <code>context.params</code> for service calls. Utility function.</li>
<li><a href="#paramsforserver">paramsForServer</a> - Pass an explicit <code>context.params</code> from client to server. Client-side. Utility function.</li>
<li><a href="#paramsfromclient">paramsFromClient</a> - Pass <code>context.params</code> from client to server. Server hook.</li>
<li><a href="#replaceitems">replaceItems</a> - Replace the records in <code>context.data</code> or <code>context.result[.data]</code>. Utility function.</li>
<li><a href="#runhook">runHook</a> - Let's you call a hook right after the service call. Utility function.</li>
<li><a href="#setbydot">setByDot</a> - Set a property value in an object using dot notation, e.g. <code>address.city</code>. Utility function.</li></ul><h3 id="tag-Conditionals">Conditionals</h3><ul>
<li><a href="#actondefault">actOnDefault</a> - Runs a series of hooks which mutate context.data or content.result (the Feathers default).</li>
<li><a href="#actondispatch">actOnDispatch</a> - Runs a series of hooks which mutate context.dispatch.</li>
<li><a href="#alteritems">alterItems</a> - Make changes to data or result items. Very flexible.</li>
<li><a href="#combine">combine</a> - Sequentially execute multiple sync or async hooks.</li>
<li><a href="#every">every</a> - Return the <code>and</code> of a series of sync or async predicate functions.</li>
<li><a href="#iff">iff</a> - Execute one or another series of hooks depending on a sync or async predicate.</li>
<li><a href="#iffelse">iffElse</a> - Execute one array of hooks or another based on a sync or async predicate.</li>
<li><a href="#isnot">isNot</a> - Negate a sync or async predicate function.</li>
<li><a href="#isprovider">isProvider</a> - Check which transport provided the service call.</li>
<li><a href="#skipremaininghooks">skipRemainingHooks</a> - Conditionally skip running all remaining hooks.</li>
<li><a href="#some">some</a> - Return the <code>or</code> of a series of sync or async predicate functions.</li>
<li><a href="#unless">unless</a> - Execute a series of hooks if a sync or async predicate is falsey.</li>
<li><a href="#when">when</a> - An alias for <code>iff</code>.</li></ul><h3 id="tag-Data%20and%20Results">Data and Results</h3><ul>
<li><a href="#actondefault">actOnDefault</a> - Runs a series of hooks which mutate context.data or content.result (the Feathers default).</li>
<li><a href="#actondispatch">actOnDispatch</a> - Runs a series of hooks which mutate context.dispatch.</li>
<li><a href="#alteritems">alterItems</a> - Make changes to data or result items. Very flexible.</li>
<li><a href="#cache">cache</a> - Persistent, least-recently-used record cache for services.</li>
<li><a href="#disablepagination">disablePagination</a> - Disables pagination when <code>query.$limit</code> is -1 or '-1'.</li>
<li><a href="#discard">discard</a> - Delete certain fields from the record(s).</li>
<li><a href="#getitems">getItems</a> - Get the records in <code>context.data</code> or <code>context.result[.data]</code>. Utility function.</li>
<li><a href="#keep">keep</a> - Keep certain fields in the record(s), deleting the rest.</li>
<li><a href="#keepinarray">keepInArray</a> - Keep certain fields in a nested array inside the record(s), deleting the rest.</li>
<li><a href="#lowercase">lowerCase</a> - Convert certain field values to lower case.</li>
<li><a href="#mongokeys">mongoKeys</a> - Wrap MongoDB foreign keys in ObjectID.</li>
<li><a href="#preventchanges">preventChanges</a> - Prevent <code>patch</code> service calls from changing certain fields.</li>
<li><a href="#replaceitems">replaceItems</a> - Replace the records in <code>context.data</code> or <code>context.result[.data]</code>. Utility function.</li>
<li><a href="#required">required</a> - Check selected fields exist and are not falsey. Numeric 0 is acceptable.</li>
<li><a href="#runparallel">runParallel</a> - Run a hook in parallel to the other hooks and the service call.</li>
<li><a href="#setnow">setNow</a> - Create/update certain fields to the current date-time.</li>
<li><a href="#sifter">sifter</a> - Filter data or result records using a MongoDB-like selection syntax.</li>
<li><a href="#skipremaininghooks">skipRemainingHooks</a> - Conditionally skip running all remaining hooks.</li>
<li><a href="#stashbefore">stashBefore</a> - Stash current value of record, usually before mutating it. Performs a <code>get</code> call.</li>
<li><a href="#traverse">traverse</a> - Transform fields & objects in place in the record(s) using a recursive walk. Powerful.</li>
<li><a href="#validate">validate</a> - Validate data using a validation function.</li>
<li><a href="#validateschema">validateSchema</a> - Validate data using JSON-Schema.</li></ul><h3 id="tag-Dot%20notation">Dot notation</h3><ul>
<li><a href="#deletebydot">deleteByDot</a> - Deletes a property from an object using dot notation, e.g. <code>address.city</code>. Utility function.</li>
<li><a href="#existsbydot">existsByDot</a> - Check if a property exists in an object by using dot notation, e.g. <code>address.city</code>. Utility function.</li>
<li><a href="#getbydot">getByDot</a> - Return a property value from an object using dot notation, e.g. <code>address.city</code>. Utility function.</li>
<li><a href="#setbydot">setByDot</a> - Set a property value in an object using dot notation, e.g. <code>address.city</code>. Utility function.</li></ul><h3 id="tag-Imperative%20API">Imperative API</h3><ul>
<li><a href="#alteritems">alterItems</a> - Make changes to data or result items. Very flexible.</li>
<li><a href="#fastjoin">fastJoin</a> - Join related records. It's very fast.</li>
<li><a href="#traverse">traverse</a> - Transform fields & objects in place in the record(s) using a recursive walk. Powerful.</li></ul><h3 id="tag-MongoDB%20specific">MongoDB specific</h3><ul>
<li><a href="#mongokeys">mongoKeys</a> - Wrap MongoDB foreign keys in ObjectID.</li></ul><h3 id="tag-Performance">Performance</h3><ul>
<li><a href="#cache">cache</a> - Persistent, least-recently-used record cache for services.</li>
<li><a href="#fastjoin">fastJoin</a> - Join related records. It's very fast.</li>
<li><a href="#runparallel">runParallel</a> - Run a hook in parallel to the other hooks and the service call.</li></ul><h3 id="tag-Predicates">Predicates</h3><ul>
<li><a href="#alteritems">alterItems</a> - Make changes to data or result items. Very flexible.</li>
<li><a href="#every">every</a> - Return the <code>and</code> of a series of sync or async predicate functions.</li>
<li><a href="#isnot">isNot</a> - Negate a sync or async predicate function.</li>
<li><a href="#isprovider">isProvider</a> - Check which transport provided the service call.</li>
<li><a href="#some">some</a> - Return the <code>or</code> of a series of sync or async predicate functions.</li></ul><h3 id="tag-Query%20object">Query object</h3><ul>
<li><a href="#discardquery">discardQuery</a> - Delete certain fields from the query object.</li>
<li><a href="#keepquery">keepQuery</a> - Keep certain fields in the query object, deleting the rest.</li>
<li><a href="#keepqueryinarray">keepQueryInArray</a> - Keep certain fields in a nested array inside the query object, deleting the rest.</li>
<li><a href="#traverse">traverse</a> - Transform fields & objects in place in the record(s) using a recursive walk. Powerful.</li></ul><h3 id="tag-REST">REST</h3><ul>
<li><a href="#setslug">setSlug</a> - Fix slugs in URL, e.g. <code>/stores/:storeId</code>.</li>
<li><a href="#traverse">traverse</a> - Transform fields & objects in place in the record(s) using a recursive walk. Powerful.</li></ul><h3 id="tag-Relations">Relations</h3><ul>
<li><a href="#alteritems">alterItems</a> - Make changes to data or result items. Very flexible.</li>
<li><a href="#depopulate">dePopulate</a> - Remove records and properties created by the <code>populate</code> hook.</li>
<li><a href="#fastjoin">fastJoin</a> - Join related records. It's very fast.</li>
<li><a href="#mongokeys">mongoKeys</a> - Wrap MongoDB foreign keys in ObjectID.</li>
<li><a href="#populate">populate</a> - Join related records.</li>
<li><a href="#serialize">serialize</a> - Prune values from related records. Calculate new values.</li>
<li><a href="#sifter">sifter</a> - Filter data or result records using a MongoDB-like selection syntax.</li></ul><h3 id="tag-Service%20methods">Service methods</h3><ul>
<li><a href="#disablemultiitemchange">disableMultiItemChange</a> - Prevents <code>null</code> from being used as an id in patch and remove service methods.</li>
<li><a href="#disablemultiitemcreate">disableMultiItemCreate</a> - Prevents multi-item creates.</li>
<li><a href="#disablepagination">disablePagination</a> - Disables pagination when <code>query.$limit</code> is -1 or '-1'.</li>
<li><a href="#disallow">disallow</a> - Prevents access to a service method completely or for specific transports.</li>
<li><a href="#preventchanges">preventChanges</a> - Prevent <code>patch</code> service calls from changing certain fields.</li>
<li><a href="#sifter">sifter</a> - Filter data or result records using a MongoDB-like selection syntax.</li></ul><h3 id="tag-Services">Services</h3><ul>
<li><a href="#cache">cache</a> - Persistent, least-recently-used record cache for services.</li>
<li><a href="#checkcontext">checkContext</a> - Restrict a hook to run for certain methods and method types. Utility function.</li>
<li><a href="#isprovider">isProvider</a> - Check which transport provided the service call.</li>
<li><a href="#required">required</a> - Check selected fields exist and are not falsey. Numeric 0 is acceptable.</li>
<li><a href="#runhook">runHook</a> - Let's you call a hook right after the service call. Utility function.</li>
<li><a href="#runparallel">runParallel</a> - Run a hook in parallel to the other hooks and the service call.</li>
<li><a href="#sifter">sifter</a> - Filter data or result records using a MongoDB-like selection syntax.</li>
<li><a href="#skipremaininghooks">skipRemainingHooks</a> - Conditionally skip running all remaining hooks.</li>
<li><a href="#softdelete">softDelete</a> - Flag records as logically deleted instead of physically removing them. Deprecated.</li>
<li><a href="#softdelete2">softDelete2</a> - Flag records as logically deleted instead of physically removing them.</li>
<li><a href="#stashbefore">stashBefore</a> - Stash current value of record, usually before mutating it. Performs a <code>get</code> call.</li>
<li><a href="#validate">validate</a> - Validate data using a validation function.</li>
<li><a href="#validateschema">validateSchema</a> - Validate data using JSON-Schema.</li></ul><h3 id="tag-Transport">Transport</h3><ul>
<li><a href="#isprovider">isProvider</a> - Check which transport provided the service call.</li>
<li><a href="#paramsforserver">paramsForServer</a> - Pass an explicit <code>context.params</code> from client to server. Client-side. Utility function.</li>
<li><a href="#paramsfromclient">paramsFromClient</a> - Pass <code>context.params</code> from client to server. Server hook.</li>
<li><a href="#setslug">setSlug</a> - Fix slugs in URL, e.g. <code>/stores/:storeId</code>.</li></ul><h3 id="tag-Validation">Validation</h3><ul>
<li><a href="#required">required</a> - Check selected fields exist and are not falsey. Numeric 0 is acceptable.</li>
<li><a href="#validate">validate</a> - Validate data using a validation function.</li>
<li><a href="#validateschema">validateSchema</a> - Validate data using JSON-Schema.</li></ul>
<!--=============================================================================================-->
<h2 id="Hooks"><a href="#Hooks" class="headerlink" title="Hooks"></a>Hooks</h2><!--=============================================================================================-->
<h3 id="actondefault">actOnDefault( ‚Ä¶hooks )</h3>

Runs a series of hooks which mutate context.data or content.result (the Feathers default).<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/act-on-dispatch.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Coding">Coding</a>, <a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Data%20and%20Results">Data and Results</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{...Function}</code> Hook functions.</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hooks</code></td>
<td style="text-align:center"><code>...Function</code></td>
<td></td>
<td>The hooks to run. They will mutate <code>context.data</code> for before hooks, or <code>context.result</code> for after hooks. This is the default action for hooks. </td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; actOnDefault, actOnDispatch &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">    find: [</span><br><span class="line">      hook1(),</span><br><span class="line">      actOnDispatch(hook2(), actOnDefault(hook3()), hook4()),</span><br><span class="line">      hook5()</span><br><span class="line">    ]</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
<p>Hooks <code>hook1</code>, <code>hook3</code> and <code>hook5</code> will run ‚Äúnormally‚Äù, mutating <code>content.result</code>.<br>Hooks <code>hook2</code> and <code>hook4</code> will mutate <code>context.dispatch</code>.</p>
</li>
<li><p><strong>Details</strong></p>
<p>A hook can call a series of hooks using <code>actOnDispatch</code>. Some of those hooks may call other hooks with <code>actOnDefault</code> or <code>actOnDispatch</code>. This can ‚Äúturtle down‚Äù to further layers.</p>
<p>The main purpose of <code>actOnDefault</code> is to ‚Äúundo‚Äù <code>actOnDispatch</code>.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/act-on-dispatch.js" target="_blank" rel="external">actOnDefault</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Coding">Coding</a>, <a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Data%20and%20Results">Data and Results</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20actOnDefault&body=Comment%20-%20Hooks%20-%20actOnDefault" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="actondispatch">actOnDispatch( ‚Ä¶hooks )</h3>

Runs a series of hooks which mutate context.dispatch.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/act-on-dispatch.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Coding">Coding</a>, <a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Data%20and%20Results">Data and Results</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{...Function}</code> Hook functions.</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hooks</code></td>
<td style="text-align:center"><code>...Function</code></td>
<td></td>
<td>The hooks to run. They will mutate <code>context.dispatch</code>.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; actOnDefault, actOnDispatch &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">    find: [</span><br><span class="line">      hook1(),</span><br><span class="line">      actOnDispatch(hook2(), actOnDefault(hook3()), hook4()),</span><br><span class="line">      hook5()</span><br><span class="line">    ]</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
<p>Hooks <code>hook1</code>, <code>hook3</code> and <code>hook5</code> will run ‚Äúnormally‚Äù, mutating <code>content.result</code>.<br>Hooks <code>hook2</code> and <code>hook4</code> will mutate <code>context.dispatch</code>.</p>
</li>
<li><p><strong>Details</strong></p>
<p>A hook can call a series of hooks using <code>actOnDispatch</code>. Some of those hooks may call other hooks with <code>actOnDefault</code> or <code>actOnDispatch</code>. This can ‚Äúturtle down‚Äù to further layers.</p>
<p class="tip">context.dispatch is a writeable, optional property and contains a ‚Äúsafe‚Äù version of the data that should be sent to any client. If context.dispatch has not been set context.result will be sent to the client instead.<br><br>Note: context.dispatch only affects the data sent through a Feathers Transport like REST or Socet.io. An internal method call will still get the data set in context.result.</p>

</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/act-on-dispatch.js" target="_blank" rel="external">actOnDispatch</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Coding">Coding</a>, <a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Data%20and%20Results">Data and Results</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20actOnDispatch&body=Comment%20-%20Hooks%20-%20actOnDispatch" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="alteritems">alterItems( func )</h3>

Make changes to data or result items. Very flexible.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/alter-items.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Coding">Coding</a>, <a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Imperative%20API">Imperative API</a>, <a href="#tag-Predicates">Predicates</a>, <a href="#tag-Relations">Relations</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong> <ul>
<li><code>{Function} func</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>func</code></td>
<td style="text-align:center"><code>Function</code></td>
<td><code>(item,</code> <code>context) =&gt;</code> <code>{}</code></td>
<td>Function modifies <code>item</code> in place. See below.</td>
</tr>
</tbody>
</table>

  <ul><li>
    <strong>Returns</strong>
    <ul><li>
      <code>{undefined || item} result</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>result</code></td>
    <td style="text-align:center"><code>undefined || item</code></td>
    <td style="text-align:left">The mutated <code>item</code>. Returning <code>undefined</code> means the <code>item</code> in the parameters was mutated in place.</td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; alterItems &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">    all: [</span><br><span class="line">      alterItems(<span class="function"><span class="params">rec</span> =&gt;</span> &#123; <span class="keyword">delete</span> rec.password; &#125;) <span class="comment">// Like `discard('password')`.</span></span><br><span class="line">      alterItems(<span class="function"><span class="params">rec</span> =&gt;</span> rec.email = email.lowerCase()), <span class="comment">// Like `lowerCase('email')`.</span></span><br><span class="line">    ],</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
<p>Async mutations can be handled with async/await:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">alterItems(<span class="function"><span class="params">rec</span> =&gt;</span> &#123;</span><br><span class="line">  rec.userRecord = <span class="function">(<span class="params"><span class="keyword">async</span> (</span>) =&gt;</span> <span class="keyword">await</span> service.get(...) )()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>You can also perform async mutations using Promises by returning a Promise that is resolved once all mutations are complete:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">alterItems(<span class="function"><span class="params">rec</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">  service.get(...).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    rec.userRecord = result;</span><br><span class="line">    resolve();</span><br><span class="line">&#125;&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>  You can also perform async mutations using Promises by returning a Promise that is resolved once all mutations are complete:<br>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">alterItems(<span class="keyword">async</span> rec =&gt; &#123;</span><br><span class="line">  rec.userRecord = <span class="keyword">await</span> service.get(...);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p><strong>Details</strong></p>
<p>The declarative nature of most of the common hooks, e.g. <code>discard(&#39;password&#39;)</code>, requires you to remember the names of a fair number of hooks, their parameters, and any possible nuances.</p>
<p>The <code>alterItems</code> hook offers an imperative alternative where you directly alter the items. It allows you to reduce the number of trivial hooks you have to register, and you are aware of exactly what your <code>alterItems</code> hooks do.</p>
<p><code>func</code> is called for each item in <code>context.data</code> (before hook) or <code>context.result[.data]</code> (after hook). It receives the parameters</p>
<ul>
<li><code>{Object} item</code></li>
<li><code>{Object} context</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>item</code></td>
<td style="text-align:center"><code>Object</code></td>
<td>The item. The function modifies it in place.</td>
</tr>
<tr>
<td>  <code>context</code></td>
<td style="text-align:center"><code>Object</code></td>
<td>The current context. It contains any alterations made to items so far.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Returns</strong></p>
<p><code>func</code> may alternatively return a replacement <code>item</code> rather than <code>undefined</code>. This is a convenience feature which permits, for example, use of functions from the <a href="https://lodash.com/" target="_blank" rel="noopener">Lodash</a> library, as such functions tend to return new objects.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/alter-items.js" target="_blank" rel="external">alterItems</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Coding">Coding</a>, <a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Imperative%20API">Imperative API</a>, <a href="#tag-Predicates">Predicates</a>, <a href="#tag-Relations">Relations</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20alterItems&body=Comment%20-%20Hooks%20-%20alterItems" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="cache">cache(cacheMap [, keyField] [, options ])</h3>

Persistent, least-recently-used record cache for services.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/cache.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Performance">Performance</a>, <a href="#tag-Services">Services</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{Object | Map} cacheMap</code></li>
<li><code>{String} [ keyField ]</code></li>
<li><code>{Object} [ options ]</code><ul>
<li><code>{Function} [ clone ]</code></li>
<li><code>{Function} [makeCacheKey]</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cacheMap</code></td>
<td style="text-align:center"><code>Object</code> <code>Map</code></td>
<td></td>
<td>Instance of <code>Map</code>, or an object with a similar API, to be used as the cache.</td>
</tr>
<tr>
<td><code>keyField</code></td>
<td style="text-align:center"><code>String</code></td>
<td><code>context.service.id</code> or <code>item._id ? &#39;_id&#39; !! &#39;id&#39;</code></td>
<td>The name of the record id field.</td>
</tr>
<tr>
<td><code>option</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>Options.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>options</code></th>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><code>clone</code></td>
<td style="text-align:center"><code>Function</code></td>
<td><code>item =&gt; JSON.parse(</code> <code>JSON.stringify(item) )</code></td>
<td>Function to perform a deep clone. See below.</td>
</tr>
<tr>
<td></td>
<td><code>clone</code></td>
<td style="text-align:center"><code>Function</code></td>
<td><code>key =&gt; key</code></td>
<td>Function to convert record key to cache key. Use this to convert MongoDB/Mongoose ObjectId/bson keys to a cache key using <code>item._id.toString()</code>.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> CacheMap = <span class="built_in">require</span>(<span class="string">'@feathers-plus/cache'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; cache &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cacheMap = CacheMap(&#123; <span class="attr">max</span>: <span class="number">100</span> &#125;); <span class="comment">// Keep the 100 most recently used.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  before: &#123;</span><br><span class="line">    all: cache(cacheMap)</span><br><span class="line">  &#125;,</span><br><span class="line">  after: &#123;</span><br><span class="line">    all: cache(cacheMap)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; cache &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cacheMap = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  before: &#123;</span><br><span class="line">    all: cache(cacheMap)</span><br><span class="line">  &#125;,</span><br><span class="line">  after: &#123;</span><br><span class="line">    all: cache(cacheMap)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> CacheMap = <span class="built_in">require</span>(<span class="string">'@feathers-plus/cache'</span>);</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; cache &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cacheMap = CacheMap(&#123; <span class="attr">max</span>: <span class="number">100</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> makeCacheKey = <span class="function"><span class="params">key</span> =&gt;</span> key <span class="keyword">instanceof</span> mongoose.Types.ObjectId ?</span><br><span class="line">  key.toString() : key;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  before: &#123;</span><br><span class="line">    all: cache(cacheMap, <span class="literal">undefined</span>, &#123; makeCacheKey &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  after: &#123;</span><br><span class="line">    all: cache(cacheMap, <span class="literal">undefined</span>, &#123; makeCacheKey &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>The <code>cache</code> hook <strong>must</strong> be registered in both <code>before</code> and <code>after</code>.</p>
</blockquote>
  <p class="tip">The cache will grow without limit when <code>Map</code> is used and the resulting memory pressure may adversely affect your performance. <code>Map</code> should only be used when you know or can control its size.</p>

<ul>
<li><p><strong>Details</strong></p>
<p>The <code>cache</code> hook maintain a persistent cache for the service it is registerd on. A persistent cache stores records so future requests for those records can be served faster; the records stored in the cache are duplicates of records stored in the database.</p>
<p>The <code>get</code> service method retrieves records from the cache and updates <code>context.result</code> <code>[.data]</code>. The other methods remove their <code>context.data</code> entries from the cache in the <code>before</code> hook, and add entries in the <code>after</code> hook. All the records returned by a <code>find</code> call are added to the cache. </p>
<p>The <code>cache</code> hook may be provided a custom Map instance to use as its memoization cache. Any object that implements the methods get(), set(), delete() and clear() can be provided. This allows for custom Maps which implement various <a href="https://en.wikipedia.org/wiki/Cache_replacement_policies" target="_blank" rel="noopener">cache algorithms</a> to be provided.</p>
<p>The companion <code>@feathers-plus/cache</code> provides a least recently-used cache which discards the least recently used items first. It is compatible with <code>cache</code> as well as the BatchLoaders used with the <code>fastJoin</code> hook.</p>
<blockquote>
<p>The <code>cache</code> hook can make <a href="#fastjoin">fastJoin</a> hooks run more efficiently.</p>
</blockquote>
<p>MongoDB and Mongoose store record keys as bson objects rather than as scalars. The safest way to use the cache is in conjunction with the <code>makeCacheKey</code> option.</p>
</li>
<li><p><strong>options.clone</strong></p>
<p>The clone function has a single parameter.</p>
<ul>
<li><code>{Object} item</code></li>
</ul>
<p>It returns</p>
<ul>
<li><code>{Object} clonedItem</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>item</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The record.</td>
</tr>
<tr>
<td><code>clonedItem</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>A clone of <code>item</code>.</td>
</tr>
</tbody>
</table>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/cache.js" target="_blank" rel="external">cache</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Performance">Performance</a>, <a href="#tag-Services">Services</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20cache&body=Comment%20-%20Hooks%20-%20cache" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="debug">debug( label [, ‚Ä¶fieldNames ] )</h3>


Display the current hook <code>context</code> for debugging.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/debug.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Coding">Coding</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong> <ul>
<li><code>{String} label</code></li>
<li><code>{Array &lt; String &gt;} [ fieldNames ]</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>label</code></td>
<td style="text-align:center"><code>String</code></td>
<td></td>
<td>Label to identify the logged information.</td>
</tr>
<tr>
<td><code>fieldNames</code></td>
<td style="text-align:center">dot notation</td>
<td></td>
<td>The field values in <code>context.params</code> to display.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; debug &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">    all: [ debug(<span class="string">'step 1'</span>), setNow(<span class="string">'updatedAt'</span>), debug(<span class="string">' step 2'</span>) ],</span><br><span class="line">&#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Result</span></span><br><span class="line">* step <span class="number">1</span></span><br><span class="line">type: before, <span class="attr">method</span>: create</span><br><span class="line">data: &#123; <span class="attr">name</span>: <span class="string">'Joe Doe'</span> &#125;</span><br><span class="line">query: &#123; <span class="attr">sex</span>: <span class="string">'m'</span> &#125;</span><br><span class="line">result: &#123; <span class="attr">assigned</span>: <span class="literal">true</span> &#125;</span><br><span class="line">params props: [ <span class="string">'query'</span> ]</span><br><span class="line">* step <span class="number">2</span></span><br><span class="line">type: before, <span class="attr">method</span>: create</span><br><span class="line">data: &#123; <span class="attr">name</span>: <span class="string">'Joe Doe'</span>, <span class="attr">createdAt</span>: <span class="number">1510518511547</span> &#125;</span><br><span class="line">query: &#123; <span class="attr">sex</span>: <span class="string">'m'</span> &#125;</span><br><span class="line">result: &#123; <span class="attr">assigned</span>: <span class="literal">true</span> &#125;</span><br><span class="line">params props: [ <span class="string">'query'</span> ]</span><br><span class="line">params.query: &#123; <span class="attr">sex</span>: <span class="string">'m'</span> &#125;</span><br><span class="line">error: ...</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p><code>debug</code> is great for debugging issues with hooks. Log the hook context before and after a hook to see what the hook started with, and what it changed.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/debug.js" target="_blank" rel="external">debug</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Coding">Coding</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20debug&body=Comment%20-%20Hooks%20-%20debug" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="depopulate">dePopulate( )</h3>

Remove records and properties created by the <code>populate</code> hook.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/de-populate.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Relations">Relations</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong> <ul>
<li><code>{Function} customDepop</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>customDepop</code></td>
<td style="text-align:center"><code>Function</code></td>
<td><code>rec =&gt; rec</code></td>
<td>Additional modifications for a record.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; dePopulate &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">    all: [ depopulate() ],</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>Removes joined records, computed properties, and profile information created by <a href="#populate"><code>populate</code></a>. Populated and serialized items may, after dePopulate, be used in service calls.</p>
<p>Removes fields created by resolver functions using <code>fgraphql</code>. Populated items may, after dePopulate, be used in a patch service call..</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/de-populate.js" target="_blank" rel="external">dePopulate</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Relations">Relations</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20dePopulate&body=Comment%20-%20Hooks%20-%20dePopulate" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="disablemultiitemchange">disableMultiItemChange( )</h3>

Prevents <code>null</code> from being used as an id in patch and remove service methods.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">no</td>
    <td style="text-align:center">update, patch, remove</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/disable-multi-item-change.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Service%20methods">Service methods</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; disableMultiItemChange &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  patch: disableMultiItemChange(),</span><br><span class="line">  remove: disableMultiItemChange() </span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>When using the <code>patch</code> or <code>remove</code> methods, a <code>null</code> id could mutate many, even all the records in the database, so accidentally using it may cause undesirable results.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/disable-multi-item-change.js" target="_blank" rel="external">disableMultiItemChange</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Service%20methods">Service methods</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20disableMultiItemChange&body=Comment%20-%20Hooks%20-%20disableMultiItemChange" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="disablemultiitemcreate">disableMultiItemCreate( )</h3>

Prevents multi-item creates.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">no</td>
    <td style="text-align:center">create</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/disable-multi-item-create.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Service%20methods">Service methods</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; disableMultiItemCreate &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  create: disableMultiItemCreate()</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>The <code>create</code> method creates multiple record if passed an array of items. This hook prevents that, allowing only single records to be created.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/disable-multi-item-create.js" target="_blank" rel="external">disableMultiItemCreate</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Service%20methods">Service methods</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20disableMultiItemCreate&body=Comment%20-%20Hooks%20-%20disableMultiItemCreate" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="disablepagination">disablePagination()</h3>

Disables pagination when <code>query.$limit</code> is -1 or '-1'.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">no</td>
    <td style="text-align:center">find</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/disable-pagination.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Service%20methods">Service methods</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; disablePagination &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  find: disablePagination()</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>Pagination is disabled if <code>context.query.$limit</code> is -1 or ‚Äò-1‚Äô. It works for all types of calls including REST.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/disable-pagination.js" target="_blank" rel="external">disablePagination</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Service%20methods">Service methods</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20disablePagination&body=Comment%20-%20Hooks%20-%20disablePagination" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="disallow">disallow( ‚Ä¶transports )</h3>

Prevents access to a service method completely or for specific transports.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/disallow.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Service%20methods">Service methods</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{Array&lt; String &gt;} transports</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>transports</code></td>
<td style="text-align:center"><code>Array&lt; String &gt;</code></td>
<td>disallow all transports</td>
<td>The transports that you want to disallow.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>transports</code></th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><code>socketio</code></td>
<td>disallow calls by Socket.IO transport</td>
</tr>
<tr>
<td></td>
<td><code>primus</code></td>
<td>disallow calls by Primus transport</td>
</tr>
<tr>
<td></td>
<td><code>rest</code></td>
<td>disallow calls by REST transport</td>
</tr>
<tr>
<td></td>
<td><code>external</code></td>
<td>disallow calls other than from server</td>
</tr>
<tr>
<td></td>
<td><code>server</code></td>
<td>disallow calls from server</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; disallow, iff &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">    <span class="comment">// Users can not be created by external access</span></span><br><span class="line">    create: disallow(<span class="string">'external'</span>),</span><br><span class="line">    <span class="comment">// A user can not be deleted through the REST provider</span></span><br><span class="line">    remove: disallow(<span class="string">'rest'</span>),</span><br><span class="line">    <span class="comment">// disallow calling `update` completely (e.g. to allow only `patch`)</span></span><br><span class="line">    update: disallow(),</span><br><span class="line">    <span class="comment">// disallow the remove hook if the user is not an admin</span></span><br><span class="line">    remove: iff(<span class="function"><span class="params">context</span> =&gt;</span> !context.params.user.isAdmin, disallow())</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>Prevents access to a service method completely or just for specific transports. All transports set the <code>context.params.provider</code> property, and <code>disallow</code> checks this.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/disallow.js" target="_blank" rel="external">disallow</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Service%20methods">Service methods</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20disallow&body=Comment%20-%20Hooks%20-%20disallow" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="discard">discard( ‚Ä¶fieldNames )</h3>

Delete certain fields from the record(s).<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center">create, update, patch</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/discard.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a></td>
  </tr>
    <tr>
      <td style="text-align:center"></td>
      <td style="text-align:center">yes</td>
      <td style="text-align:center">all</td>
    </tr>
  </tbody>
  </table>
<p class="tip">The discard hook will remove fields even if the service is being called from the server. You may want to condition the hook to run only for external transports, e.g. <code>iff(isProvider(&#39;external&#39;), discard(...))</code>.</p>


  <ul><li>
    <strong>Arguments</strong>
    <ul><li>
      <code>{Array < String >} fieldNames</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>fieldNames</code></td>
    <td style="text-align:center">dot notation</td>
    <td style="text-align:left">One or more fields you want to remove from the record(s).</td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; discard , iff, isProvider &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">    all: iff(isProvider(<span class="string">'external'</span>), discard(<span class="string">'password'</span>, <span class="string">'address.city'</span>))</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>Delete the fields either from <code>context.data</code> (before hook) or <code>context.result[.data]</code> (after hook).<br>They are not modified if they are not an object, so a <code>null</code> value is supported.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/discard.js" target="_blank" rel="external">discard</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20discard&body=Comment%20-%20Hooks%20-%20discard" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="discardquery">discardQuery( ‚Ä¶fieldNames )</h3>

Delete certain fields from the query object.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">no</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/discard-query.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Query%20object">Query object</a></td>
  </tr>
  </tbody>
  </table>
<p class="tip">The keep hook will remove any fields not specified even if the service is being called from the server. You may want to condition the hook to run only for external transports, e.g. <code>iff(isProvider(&#39;external&#39;), discardQuery(...))</code>.</p>


  <ul><li>
    <strong>Arguments</strong>
    <ul><li>
      <code>{Array < String >} fieldNames</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>fieldNames</code></td>
    <td style="text-align:center">dot notation</td>
    <td style="text-align:left">One or more fields you want to remove from the query.</td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; discardQuery , iff, isProvider &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">    all: iff(isProvider(<span class="string">'external'</span>), discardQuery(<span class="string">'secret'</span>))</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>Delete the fields from <code>context.params.query</code>.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/discard-query.js" target="_blank" rel="external">discardQuery</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Query%20object">Query object</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20discardQuery&body=Comment%20-%20Hooks%20-%20discardQuery" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="every">every( ‚Ä¶predicates )</h3>

Return the <code>and</code> of a series of sync or async predicate functions.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/every.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Predicates">Predicates</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Array&lt; Function &gt;} predicates</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>predicates</code></td>
<td style="text-align:center"><code>Array&lt; Function &gt;</code></td>
<td></td>
<td>Functions which take the current hook as a param and return a boolean result.</td>
</tr>
</tbody>
</table>

  <ul><li>
    <strong>Returns</strong>
    <ul><li>
      <code>{Boolean} result</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>result</code></td>
    <td style="text-align:center"><code>Boolean</code></td>
    <td style="text-align:left">The logical and of <code>predicates</code></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; iff, every &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">    create: iff(every(hook1, hook2, ...), hookA, hookB, ...)</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p><code>every</code> is a predicate function for use in conditional hooks. The predicate functions are run in parallel, and <code>true</code> is returned if every predicate returns a truthy value.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/every.js" target="_blank" rel="external">every</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Predicates">Predicates</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20every&body=Comment%20-%20Hooks%20-%20every" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="fastjoin">fastJoin( schema [, query] )</h3>

Join related records. It's very fast.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"><a href="guide.html#fastJoin">fastJoin</a></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/fast-join.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Imperative%20API">Imperative API</a>, <a href="#tag-Performance">Performance</a>, <a href="#tag-Relations">Relations</a></td>
  </tr>
  </tbody>
  </table>
<blockquote>
<p><code>fastJoin</code> is preferred over using <code>populate</code>.</p>
</blockquote>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><p><code>{Object | Function} resolvers</code></p>
<ul>
<li><code>{Function} [ before ]</code></li>
<li><code>{Function} [ after ]</code></li>
<li><code>{Object} joins</code></li>
</ul>
</li>
<li><p><code>{Object | Function} [ query ]</code></p>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>resolvers</code></td>
<td><code>Object</code> or <code>context</code> <code>=&gt; Object</code></td>
<td></td>
<td>The group of operations to perform on the data.</td>
</tr>
<tr>
<td><code>query</code></td>
<td><code>Object</code></td>
<td>run all resolvers with <code>undefined</code> params</td>
<td>You can customise the current operations with the optional query.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>resolvers</code></th>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><code>before</code></td>
<td><code>context</code> <code>=&gt; { }</code></td>
<td></td>
<td>Processing performed before the operations are started. Batch-loaders are usually created here.</td>
</tr>
<tr>
<td></td>
<td><code>after</code></td>
<td><code>context</code> <code>=&gt; { }</code></td>
<td></td>
<td>Processing performed after all other operations are completed.</td>
</tr>
<tr>
<td></td>
<td><code>joins</code></td>
<td><code>Object</code></td>
<td></td>
<td>Resolver functions provide a mapping between a portion of a operation and actual backend code responsible for handling it.</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Read the <a href="guide.html#fastjoin">guide</a> for more information on the arguments.</p>
</blockquote>
<ul>
<li><p><strong>Example using Feathers services</strong></p>
<p></p><p class="tip">The services in all these examples are assumed, for simplicity, to have pagination disabled. You will have to decide when to use <code>paginate: false</code> in your code.</p><p></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// project/src/services/posts/posts.hooks.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; fastJoin &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postResolvers = &#123;</span><br><span class="line">  joins: &#123;</span><br><span class="line">    author: <span class="function">(<span class="params">...args</span>) =&gt;</span> <span class="keyword">async</span> post =&gt; post.author = (<span class="keyword">await</span> users.find(&#123;</span><br><span class="line">      query: &#123; <span class="attr">id</span>: post.userId &#125;,</span><br><span class="line">      paginate: <span class="literal">false</span></span><br><span class="line">    &#125;))[<span class="number">0</span>],</span><br><span class="line">    </span><br><span class="line">    starers: <span class="function"><span class="params">$select</span> =&gt;</span> <span class="keyword">async</span> post =&gt; post.starers = <span class="keyword">await</span> users.find(&#123;</span><br><span class="line">      query: &#123; <span class="attr">id</span>: &#123; <span class="attr">$in</span>: post.starIds &#125;, <span class="attr">$select</span>: $select || [<span class="string">'name'</span>] &#125;,</span><br><span class="line">      paginate: <span class="literal">false</span></span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> query = &#123;</span><br><span class="line">  author: <span class="literal">true</span>,</span><br><span class="line">  starers: [[<span class="string">'id'</span>, <span class="string">'name'</span>]]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">    all: [ fastJoin(postResolvers, query) ],</span><br><span class="line">&#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Original record</span></span><br><span class="line">[ &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">body</span>: <span class="string">'John post'</span>, <span class="attr">userId</span>: <span class="number">101</span>, <span class="attr">starIds</span>: [<span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span>] &#125; ]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Result</span></span><br><span class="line">[ &#123; <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    body: <span class="string">'John post'</span>,</span><br><span class="line">    userId: <span class="number">101</span>,</span><br><span class="line">    starIds: [ <span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span> ],</span><br><span class="line">    author: &#123; <span class="attr">id</span>: <span class="number">101</span>, <span class="attr">name</span>: <span class="string">'John'</span> &#125;,</span><br><span class="line">    starers: [ &#123; <span class="attr">name</span>: <span class="string">'Marshall'</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">'Barbara'</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">'Aubree'</span> &#125; ]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Example with recursive operations</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// project/src/services/posts/posts.hooks.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; fastJoin &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> postResolvers = &#123;</span><br><span class="line">  joins: &#123;</span><br><span class="line">    comments: &#123;</span><br><span class="line">      resolver: <span class="function">(<span class="params">$select, $limit, $sort</span>) =&gt;</span> <span class="keyword">async</span> post =&gt; post.comments = <span class="keyword">await</span> comments.find(&#123;</span><br><span class="line">        query: &#123; <span class="attr">postId</span>: post.id, <span class="attr">$select</span>: $select, <span class="attr">$limit</span>: $limit || <span class="number">5</span>, [$sort]: &#123; <span class="attr">createdAt</span>: <span class="number">-1</span> &#125; &#125;,</span><br><span class="line">        paginate: <span class="literal">false</span></span><br><span class="line">      &#125;),</span><br><span class="line">        </span><br><span class="line">      joins: &#123;</span><br><span class="line">        author: <span class="function"><span class="params">$select</span> =&gt;</span> <span class="keyword">async</span> comment =&gt; comment.author = (<span class="keyword">await</span> users.find(&#123;</span><br><span class="line">          query: &#123; <span class="attr">id</span>: comment.userId, <span class="attr">$select</span>: $select &#125;,</span><br><span class="line">          paginate: <span class="literal">false</span></span><br><span class="line">        &#125;))[<span class="number">0</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> query = &#123;</span><br><span class="line">  comments: &#123;</span><br><span class="line">    args: [...],</span><br><span class="line">    author: [[<span class="string">'id'</span>, <span class="string">'name'</span>]]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">    all: [ fastJoin(postResolvers, query) ],</span><br><span class="line">&#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Original record</span></span><br><span class="line">[ &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">body</span>: <span class="string">'John post'</span>, <span class="attr">userId</span>: <span class="number">101</span>, <span class="attr">starIds</span>: [<span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span>] &#125; ]</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Result</span></span><br><span class="line">[ &#123; <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    body: <span class="string">'John post'</span>,</span><br><span class="line">    userId: <span class="number">101</span>,</span><br><span class="line">    starIds: [ <span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span> ],</span><br><span class="line">    comments: </span><br><span class="line">     [ &#123; <span class="attr">id</span>: <span class="number">11</span>,</span><br><span class="line">         text: <span class="string">'John post Marshall comment 11'</span>,</span><br><span class="line">         postId: <span class="number">1</span>,</span><br><span class="line">         userId: <span class="number">102</span>,</span><br><span class="line">         author: &#123; <span class="attr">id</span>: <span class="number">102</span>, <span class="attr">name</span>: <span class="string">'Marshall'</span> &#125; &#125;,</span><br><span class="line">       &#123; <span class="attr">id</span>: <span class="number">12</span>,</span><br><span class="line">         text: <span class="string">'John post Marshall comment 12'</span>,</span><br><span class="line">         postId: <span class="number">1</span>,</span><br><span class="line">         userId: <span class="number">102</span>,</span><br><span class="line">         author: &#123; <span class="attr">id</span>: <span class="number">102</span>, <span class="attr">name</span>: <span class="string">'Marshall'</span> &#125; &#125;,</span><br><span class="line">       &#123; <span class="attr">id</span>: <span class="number">13</span>,</span><br><span class="line">         text: <span class="string">'John post Marshall comment 13'</span>,</span><br><span class="line">         postId: <span class="number">1</span>,</span><br><span class="line">         userId: <span class="number">102</span>,</span><br><span class="line">         author: &#123; <span class="attr">id</span>: <span class="number">102</span>, <span class="attr">name</span>: <span class="string">'Marshall'</span> &#125; &#125; ]</span><br><span class="line">&#125; ]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Example with a simple batch-loader</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// project/src/services/posts/posts.hooks.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; fastJoin &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"><span class="keyword">const</span> BatchLoader = <span class="built_in">require</span>(<span class="string">'@feathers-plus/batch-loader'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; loaderFactory &#125; = BatchLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postResolvers = &#123;</span><br><span class="line">  before: <span class="function"><span class="params">context</span> =&gt;</span> &#123;</span><br><span class="line">    context._loaders = &#123; <span class="attr">user</span>: &#123;&#125; &#125;;</span><br><span class="line">    context._loaders.user.id = loaderFactory(users, <span class="string">'id'</span>, <span class="literal">false</span>, &#123; <span class="attr">paginate</span>: <span class="literal">false</span> &#125;)(context);</span><br><span class="line">  &#125;,</span><br><span class="line">  joins: &#123;</span><br><span class="line">    author: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">async</span> (post, context) =&gt;</span><br><span class="line">      post.author = <span class="keyword">await</span> context._loaders.user.id.load(post.userId),</span><br><span class="line">      </span><br><span class="line">    starers: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">async</span> (post, context) =&gt; !post.starIds ? <span class="literal">null</span> :</span><br><span class="line">      post.starers = <span class="keyword">await</span> context._loaders.user.id.loadMany(post.starIds),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">    all: [ fastJoin(postResolvers) ],</span><br><span class="line">&#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Original record</span></span><br><span class="line">[ &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">body</span>: <span class="string">'John post'</span>, <span class="attr">userId</span>: <span class="number">101</span>, <span class="attr">starIds</span>: [<span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span>] &#125; ]</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Result</span></span><br><span class="line">[ &#123; <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    body: <span class="string">'John post'</span>,</span><br><span class="line">    userId: <span class="number">101</span>,</span><br><span class="line">    starIds: [ <span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span> ],</span><br><span class="line">    author: &#123; <span class="attr">id</span>: <span class="number">101</span>, <span class="attr">name</span>: <span class="string">'John'</span> &#125;,</span><br><span class="line">    starers: </span><br><span class="line">     [ &#123; <span class="attr">id</span>: <span class="number">102</span>, <span class="attr">name</span>: <span class="string">'Marshall'</span> &#125;,</span><br><span class="line">       &#123; <span class="attr">id</span>: <span class="number">103</span>, <span class="attr">name</span>: <span class="string">'Barbara'</span> &#125;,</span><br><span class="line">       &#123; <span class="attr">id</span>: <span class="number">104</span>, <span class="attr">name</span>: <span class="string">'Aubree'</span> &#125; ]</span><br><span class="line">&#125; ]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Comprehensive example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// project/src/services/posts/posts.hooks.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; fastJoin, makeCallingParams &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"><span class="keyword">const</span> BatchLoader = <span class="built_in">require</span>(<span class="string">'@feathers-plus/batch-loader'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; getResultsByKey, getUniqueKeys &#125; = BatchLoader;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> commentResolvers = &#123;</span><br><span class="line">  joins: &#123;</span><br><span class="line">    author: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">async</span> (comment, context) =&gt; !comment.userId ? <span class="literal">null</span> :</span><br><span class="line">      comment.userRecord = <span class="keyword">await</span> context._loaders.user.id.load(comment.userId)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postResolvers = &#123;</span><br><span class="line">  before: <span class="function"><span class="params">context</span> =&gt;</span> &#123;</span><br><span class="line">    context._loaders = &#123; <span class="attr">user</span>: &#123;&#125;, <span class="attr">comments</span>: &#123;&#125; &#125;;</span><br><span class="line">    </span><br><span class="line">    context._loaders.user.id = <span class="keyword">new</span> BatchLoader(<span class="keyword">async</span> (keys, context) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> users.find(makeCallingParams(</span><br><span class="line">          context, &#123; <span class="attr">id</span>: &#123; <span class="attr">$in</span>: getUniqueKeys(keys) &#125; &#125;, <span class="literal">undefined</span>, &#123; <span class="attr">paginate</span>: <span class="literal">false</span> &#125;</span><br><span class="line">        ));</span><br><span class="line">        <span class="keyword">return</span> getResultsByKey(keys, result, user =&gt; user.id, <span class="string">'!'</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; context &#125;</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    context._loaders.comments.postId = <span class="keyword">new</span> BatchLoader(<span class="keyword">async</span> (keys, context) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> comments.find(makeCallingParams(</span><br><span class="line">          context, &#123; <span class="attr">postId</span>: &#123; <span class="attr">$in</span>: getUniqueKeys(keys) &#125; &#125;, <span class="literal">undefined</span>, &#123; <span class="attr">paginate</span>: <span class="literal">false</span> &#125;</span><br><span class="line">        ));</span><br><span class="line">        <span class="keyword">return</span> getResultsByKey(keys, result, comment =&gt; comment.postId, <span class="string">'[!]'</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; context &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">  joins: &#123;</span><br><span class="line">    author: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">async</span> (post, context) =&gt;</span><br><span class="line">      post.userRecord = <span class="keyword">await</span> context._loaders.user.id.load(post.userId),</span><br><span class="line">      </span><br><span class="line">    starers: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">async</span> (post, context) =&gt; !post.starIds ? <span class="literal">null</span> :</span><br><span class="line">      post.starIdsRecords = <span class="keyword">await</span> context._loaders.user.id.loadMany(post.starIds),</span><br><span class="line">      </span><br><span class="line">    comments: &#123;</span><br><span class="line">      resolver: <span class="function">(<span class="params">...args</span>) =&gt;</span> <span class="keyword">async</span> (post, context) =&gt;</span><br><span class="line">        post.commentRecords = <span class="keyword">await</span> context._loaders.comments.postId.load(post.id),</span><br><span class="line">        </span><br><span class="line">      joins: commentResolvers,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> query = &#123;</span><br><span class="line">  author: <span class="literal">true</span>,</span><br><span class="line">  starers: [[<span class="string">'id'</span>, <span class="string">'name'</span>]],</span><br><span class="line">  comments: &#123;</span><br><span class="line">    args: <span class="literal">null</span>,</span><br><span class="line">    author: [[<span class="string">'id'</span>, <span class="string">'name'</span>]]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">    all: [ fastJoin(postResolvers, context =&gt; query) ],</span><br><span class="line">&#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Original record</span></span><br><span class="line">[ &#123; <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    body: <span class="string">'John post'</span>,</span><br><span class="line">    userId: <span class="number">101</span>,</span><br><span class="line">    starIds: [<span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span>],</span><br><span class="line">    reputation: [ <span class="comment">// The `populate` hook cannot handle this structure.</span></span><br><span class="line">      &#123; <span class="attr">userId</span>: <span class="number">102</span>, <span class="attr">points</span>: <span class="number">1</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">userId</span>: <span class="number">103</span>, <span class="attr">points</span>: <span class="number">1</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">userId</span>: <span class="number">104</span>, <span class="attr">points</span>: <span class="number">1</span> &#125;</span><br><span class="line">    ]&#125;,</span><br><span class="line">]</span><br><span class="line">  </span><br><span class="line"><span class="comment">// Results</span></span><br><span class="line">[ &#123; <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    body: <span class="string">'John post'</span>,</span><br><span class="line">    userId: <span class="number">101</span>,</span><br><span class="line">    starIds: [ <span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span> ],</span><br><span class="line">    reputation: </span><br><span class="line">     [ &#123; <span class="attr">userId</span>: <span class="number">102</span>, <span class="attr">points</span>: <span class="number">1</span>, <span class="attr">author</span>: <span class="string">'Marshall'</span> &#125;,</span><br><span class="line">       &#123; <span class="attr">userId</span>: <span class="number">103</span>, <span class="attr">points</span>: <span class="number">1</span>, <span class="attr">author</span>: <span class="string">'Barbara'</span> &#125;,</span><br><span class="line">       &#123; <span class="attr">userId</span>: <span class="number">104</span>, <span class="attr">points</span>: <span class="number">1</span>, <span class="attr">author</span>: <span class="string">'Aubree'</span> &#125; ],</span><br><span class="line">    author: &#123; <span class="attr">id</span>: <span class="number">101</span>, <span class="attr">name</span>: <span class="string">'John'</span> &#125;,</span><br><span class="line">    comments: </span><br><span class="line">     [ &#123; <span class="attr">id</span>: <span class="number">11</span>,</span><br><span class="line">         text: <span class="string">'John post Marshall comment 11'</span>,</span><br><span class="line">         postId: <span class="number">1</span>,</span><br><span class="line">         userId: <span class="number">102</span>,</span><br><span class="line">         author: &#123; <span class="attr">id</span>: <span class="number">102</span>, <span class="attr">name</span>: <span class="string">'Marshall'</span> &#125; &#125;,</span><br><span class="line">       &#123; <span class="attr">id</span>: <span class="number">12</span>,</span><br><span class="line">         text: <span class="string">'John post Marshall comment 12'</span>,</span><br><span class="line">         postId: <span class="number">1</span>,</span><br><span class="line">         userId: <span class="number">102</span>,</span><br><span class="line">         author: &#123; <span class="attr">id</span>: <span class="number">102</span>, <span class="attr">name</span>: <span class="string">'Marshall'</span> &#125; &#125;,</span><br><span class="line">       &#123; <span class="attr">id</span>: <span class="number">13</span>,</span><br><span class="line">         text: <span class="string">'John post Marshall comment 13'</span>,</span><br><span class="line">         postId: <span class="number">1</span>,</span><br><span class="line">         userId: <span class="number">102</span>,</span><br><span class="line">         author: &#123; <span class="attr">id</span>: <span class="number">102</span>, <span class="attr">name</span>: <span class="string">'Marshall'</span> &#125; &#125; ],</span><br><span class="line">    starers: </span><br><span class="line">     [ &#123; <span class="attr">id</span>: <span class="number">102</span>, <span class="attr">name</span>: <span class="string">'Marshall'</span> &#125;,</span><br><span class="line">       &#123; <span class="attr">id</span>: <span class="number">103</span>, <span class="attr">name</span>: <span class="string">'Barbara'</span> &#125;,</span><br><span class="line">       &#123; <span class="attr">id</span>: <span class="number">104</span>, <span class="attr">name</span>: <span class="string">'Aubree'</span> &#125; ] &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Example Using a Persistent Cache</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; cache, fastJoin, makeCallingParams &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"><span class="keyword">const</span> BatchLoader = <span class="built_in">require</span>(<span class="string">'@feathers-plus/batch-loader'</span>);</span><br><span class="line"><span class="keyword">const</span> CacheMap = <span class="built_in">require</span>(<span class="string">'@feathers-plus/cache'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; getResultsByKey, getUniqueKeys &#125; = BatchLoader;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a cache for a maximum of 100 users</span></span><br><span class="line"><span class="keyword">const</span> cacheMapUsers = CacheMap(&#123; <span class="attr">max</span>: <span class="number">100</span> &#125;); </span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a batchLoader using the persistent cache</span></span><br><span class="line"><span class="keyword">const</span> userBatchLoader = <span class="keyword">new</span> BatchLoader(<span class="keyword">async</span> keys =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> users.find(makeCallingParams(</span><br><span class="line">    &#123;&#125;, &#123; <span class="attr">id</span>: &#123; <span class="attr">$in</span>: getUniqueKeys(keys) &#125; &#125;, <span class="literal">undefined</span>, &#123; <span class="attr">paginate</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">  <span class="keyword">return</span> getResultsByKey(keys, result, user =&gt; user.id, <span class="string">'!'</span>);</span><br><span class="line">&#125;,</span><br><span class="line">  &#123; <span class="attr">cacheMap</span>: cacheMapUsers &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postResolvers = &#123;</span><br><span class="line">  before: <span class="function"><span class="params">context</span> =&gt;</span> &#123;</span><br><span class="line">    context._loaders = &#123; <span class="attr">user</span>: &#123;&#125; &#125;;</span><br><span class="line">    context._loaders.user.id = userBatchLoader;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  joins: &#123;</span><br><span class="line">    author: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">async</span> (post, context) =&gt;</span><br><span class="line">      post.author = <span class="keyword">await</span> context._loaders.user.id.load(post.userId),</span><br><span class="line"></span><br><span class="line">    starers: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">async</span> (post, context) =&gt; !post.starIds ? <span class="literal">null</span> :</span><br><span class="line">      post.starers = <span class="keyword">await</span> context._loaders.user.id.loadMany(post.starIds),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> query = &#123;</span><br><span class="line">  author: <span class="literal">true</span>,</span><br><span class="line">  starers: [[<span class="string">'id'</span>, <span class="string">'name'</span>]],</span><br><span class="line">  comments: &#123;</span><br><span class="line">    args: <span class="literal">null</span>,</span><br><span class="line">    author: [[<span class="string">'id'</span>, <span class="string">'name'</span>]]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  before: &#123;</span><br><span class="line">    all: cache(cacheMapUsers)</span><br><span class="line">  &#125;,</span><br><span class="line">  after: &#123;</span><br><span class="line">    all: [</span><br><span class="line">      cache(cacheMapUsers),</span><br><span class="line">      fastJoin(postResolvers, () =&gt; query)</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The number of service calls needed to run the <code>query</code> above <strong>the second time</strong>:</p>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:right">Using</th>
<th style="text-align:center">number of service calls</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>populate</code></td>
<td style="text-align:center"><strong>22</strong></td>
</tr>
<tr>
<td style="text-align:right"><code>fastJoin</code> alone</td>
<td style="text-align:center"><strong>2</strong></td>
</tr>
<tr>
<td style="text-align:right"><code>fastJoin</code> and <code>cache</code></td>
<td style="text-align:center"><strong>0</strong></td>
</tr>
</tbody>
</table>
<p>  The <code>cache</code> hook also makes <code>get</code> service calls more efficient.</p>
<blockquote>
<p>The <code>cache</code> hook <strong>must</strong> be registered in both <code>before</code> and <code>after</code>.</p>
</blockquote>
<ul>
<li><p><strong>Details</strong></p>
<p>We often want to combine rows from two or more tables based on a relationship between them. The <code>fastJoin</code> hook will select records that have matching values in both tables. It can batch service calls and cache records, thereby needing roughly an order of magnitude fewer database calls than the <code>populate</code> hook, e.g. <em>2</em> calls instead of <em>20</em>.</p>
<p>Relationships such as <code>1:1</code>, <code>1:m</code>, <code>n:1</code>, and <code>n:m</code> relationships can be handled.</p>
<p><code>fastJoin</code> uses a GraphQL-like imperative API, and it is not restricted to using data from Feathers services. Resources for which there are no Feathers adapters can <a href="../batch-loader/common-patterns.html#Using-non-Feathers-services">be used.</a></p>
<p>The companion <code>@feathers-plus/cache</code> implements a least recently-used cache which discards the least recently used items first. When used in conjunction with the <code>cache</code> hook, it can be used to implement persistent caches for BatchLoaders. BatchLoaders configured this way would retain their cache between requests, eliminating the need to <em>prime</em> the cache at the start of each request.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/fast-join.js" target="_blank" rel="external">fastJoin</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: Guide <a href="guide.html#fastJoin">fastJoin</a> and tags <a href="#tag-Imperative%20API">Imperative API</a>, <a href="#tag-Performance">Performance</a>, <a href="#tag-Relations">Relations</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20fastJoin&body=Comment%20-%20Hooks%20-%20fastJoin" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="iff">iff( predicate, ‚Ä¶hookFuncsTrue ).else( ‚Ä¶hookFuncsFalse )</h3>

Execute one or another series of hooks depending on a sync or async predicate.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/iff.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Conditionals">Conditionals</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Boolean | Promise | Function} predicate</code></li>
<li><code>{Array&lt; Function &gt;} hookFuncsTrue</code></li>
<li><code>{Array&lt; Function &gt;} hookFuncsFalse</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>predicate</code></td>
<td style="text-align:center"><code>Boolean</code>, <code>Promise</code> or <code>Function</code></td>
<td></td>
<td>Determine if <code>hookFuncsTrue</code> or <code>hookFuncsFalse</code> should be run. If a function, <code>predicate</code> is called with the <code>context</code> as its param. It returns either a boolean or a Promise that evaluates to a boolean.</td>
</tr>
<tr>
<td><code>hookFuncsTrue</code></td>
<td style="text-align:center"><code>Array&lt;</code> <code>Function &gt;</code></td>
<td></td>
<td>Sync or async hook functions to run if <code>true</code>. They may include other conditional hooks.</td>
</tr>
<tr>
<td><code>hookFuncsFalse</code></td>
<td style="text-align:center"><code>Array&lt;</code> <code>Function &gt;</code></td>
<td></td>
<td>Sync or async hook functions to run if <code>false</code>. They may include other conditional hooks.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; discard, iff, isProvider, populate &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"><span class="keyword">const</span> isNotAdmin = <span class="function"><span class="params">adminRole</span> =&gt;</span> <span class="function"><span class="params">context</span> =&gt;</span> context.params.user.roles.indexOf(adminRole || <span class="string">'admin'</span>) === <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  create: iff(</span><br><span class="line">    () =&gt; <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; ... &#125;),</span><br><span class="line">    populate(<span class="string">'user'</span>, &#123; <span class="attr">field</span>: <span class="string">'authorisedByUserId'</span>, <span class="attr">service</span>: <span class="string">'users'</span> &#125;)</span><br><span class="line">  ),</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">get</span>: [ iff(isNotAdmin(), discard('budget')) ]</span><br><span class="line">  </span><br><span class="line">  update:</span><br><span class="line">    iff(isProvider('server'),</span><br><span class="line">      hookA,</span><br><span class="line">      iff(isProvider('rest'), hook1, hook2, hook3)</span><br><span class="line">      .else(hook4, hook5),</span><br><span class="line">      hookB</span><br><span class="line">    )</span><br><span class="line">    .else(</span><br><span class="line">      iff(hook =&gt; hook.path === 'users', hook6, hook7)</span><br><span class="line">    )</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>Resolve the predicate, then run one set of hooks sequentially.</p>
<p>The predicate and hook functions will not be called with <code>this</code> set to the service, as is normal for hook functions. Use <code>hook.service</code> instead.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/iff.js" target="_blank" rel="external">iff</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Conditionals">Conditionals</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20iff&body=Comment%20-%20Hooks%20-%20iff" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="iffelse">iffElse( predicate, hookFuncsTrue, hookFuncsFalse )</h3>

Execute one array of hooks or another based on a sync or async predicate.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/iff-else.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Conditionals">Conditionals</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Function} predicate</code></li>
<li><code>{Array&lt; Functions &gt;} hookFuncsTrue</code></li>
<li><code>{Array&lt; Functions &gt;} hookFuncsFalse</code> </li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>predicate</code></td>
<td style="text-align:center"><code>Boolean</code>, <code>Promise</code> or <code>Function</code></td>
<td></td>
<td>Determine if <code>hookFuncsTrue</code> or <code>hookFuncsFalse</code> should be run. If a function, <code>predicate</code> is called with the <code>context</code> as its param. It returns either a boolean or a Promise that evaluates to a boolean.</td>
</tr>
<tr>
<td><code>hookFuncsTrue</code></td>
<td style="text-align:center"><code>Array&lt;</code> <code>Function &gt;</code></td>
<td></td>
<td>Sync or async hook functions to run if <code>true</code>. They may include other conditional hooks.</td>
</tr>
<tr>
<td><code>hookFuncsFalse</code></td>
<td style="text-align:center"><code>Array&lt;</code> <code>Function &gt;</code></td>
<td></td>
<td>Sync or async hook functions to run if <code>false</code>. They may include other conditional hooks.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; iffElse, populate, serialize &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">  create: iffElse(<span class="function"><span class="params">()</span> =&gt;</span> &#123; ... &#125;,</span><br><span class="line">    [populate(poAccting), serialize( ... )],</span><br><span class="line">    [populate(poReceiving), serialize( ... )]</span><br><span class="line">  )</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>Resolve the predicate, then run one set of hooks sequentially.</p>
<p>The predicate and hook functions will not be called with <code>this</code> set to the service, as is normal for hook functions. Use <code>hook.service</code> instead.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/iff-else.js" target="_blank" rel="external">iffElse</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Conditionals">Conditionals</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20iffElse&body=Comment%20-%20Hooks%20-%20iffElse" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="isnot">isNot( predicate )</h3>

Negate a sync or async predicate function.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/is-not.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Predicates">Predicates</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{Function | Boolean} predicate</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>predicate</code></td>
<td style="text-align:center"><code>Function</code> <code>Boolean</code></td>
<td></td>
<td>A sync or async function which take the current hook as a param and returns a boolean result.</td>
</tr>
</tbody>
</table>

  <ul><li>
    <strong>Returns</strong>
    <ul><li>
      <code>{Boolean} result</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>result</code></td>
    <td style="text-align:center"><code>Boolean</code></td>
    <td style="text-align:left">The not of <code>predicate</code></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; iff, isNot, isProvider, discard &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"><span class="keyword">const</span> isRequestor = <span class="function"><span class="params">()</span> =&gt;</span> <span class="function"><span class="params">context</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(resolve, reject) =&gt; ... );</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">    create: iff(isNot(isRequestor()), discard(<span class="string">'password'</span>))</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p><code>isNot</code> is a predicate function for use in conditional hooks.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/is-not.js" target="_blank" rel="external">isNot</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Predicates">Predicates</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20isNot&body=Comment%20-%20Hooks%20-%20isNot" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="isprovider">isProvider( ‚Ä¶transports )</h3>

Check which transport provided the service call.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/is-provider.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Predicates">Predicates</a>, <a href="#tag-Services">Services</a>, <a href="#tag-Transport">Transport</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Array&lt; String &gt;} transports</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Name</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>transports</code></td>
<td style="text-align:center"><code>Array&lt; String &gt;</code></td>
<td></td>
<td>The transports you want to allow. </td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>transports</code></th>
<th style="text-align:center">Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td style="text-align:center"><code>socketio</code></td>
<td>Allow calls by Socket.IO transport.</td>
</tr>
<tr>
<td></td>
<td style="text-align:center"><code>primus</code></td>
<td>Allow calls by Primus transport.</td>
</tr>
<tr>
<td></td>
<td style="text-align:center"><code>rest</code></td>
<td>Allow calls by REST transport.</td>
</tr>
<tr>
<td></td>
<td style="text-align:center"><code>external</code></td>
<td>Allow calls other than from server.</td>
</tr>
<tr>
<td></td>
<td style="text-align:center"><code>server</code></td>
<td>Allow calls from server.</td>
</tr>
</tbody>
</table>

  <ul><li>
    <strong>Returns</strong>
    <ul><li>
      <code>{Boolean} result</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>result</code></td>
    <td style="text-align:center"><code>Boolean</code></td>
    <td style="text-align:left">If the call was made by one of the <code>transports</code>.</td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; iff, isProvider, discard &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">    create: iff(isProvider(<span class="string">'external'</span>), discard(<span class="string">'password'</span>))</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p><code>isProvider</code> is a predicate function for use in conditional hooks. Its determines which transport provided the service call by checking <code>context.params.provider</code>.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/is-provider.js" target="_blank" rel="external">isProvider</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Predicates">Predicates</a>, <a href="#tag-Services">Services</a>, <a href="#tag-Transport">Transport</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20isProvider&body=Comment%20-%20Hooks%20-%20isProvider" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="keep">keep( ‚Ä¶fieldNames )</h3>

Keep certain fields in the record(s), deleting the rest.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center">create, update, patch</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/keep.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a></td>
  </tr>
    <tr>
      <td style="text-align:center"></td>
      <td style="text-align:center">yes</td>
      <td style="text-align:center">all</td>
    </tr>
  </tbody>
  </table>
<p class="tip">The keep hook will remove any fields not specified even if the service is being called from the server. You may want to condition the hook to run only for external transports, e.g. <code>iff(isProvider(&#39;external&#39;), keep(...))</code>.</p>


  <ul><li>
    <strong>Arguments</strong>
    <ul><li>
      <code>{Array < String >} fieldNames</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>fieldNames</code></td>
    <td style="text-align:center">dot notation</td>
    <td style="text-align:left">The only fields you want to keep in the record(s).</td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; keep &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line">  </span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">  create: keep(<span class="string">'name'</span>, <span class="string">'dept'</span>, <span class="string">'address.city'</span>),</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>Update either <code>context.data</code> (before hook) or <code>context.result[.data]</code> (after hook).<br>Their values are returned if they are not an object, so a <code>null</code> value is supported.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/keep.js" target="_blank" rel="external">keep</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20keep&body=Comment%20-%20Hooks%20-%20keep" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="keepinarray">keepInArray( arrayName, fieldNames )</h3>

Keep certain fields in a nested array inside the record(s), deleting the rest.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center">create, update, patch</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/keep-in-array.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a></td>
  </tr>
    <tr>
      <td style="text-align:center"></td>
      <td style="text-align:center">yes</td>
      <td style="text-align:center">all</td>
    </tr>
  </tbody>
  </table>
<p class="tip">The keepInArray hook will remove any fields not specified even if the service is being called from the server. You may want to condition the hook to run only for external transports, e.g. <code>iff(isProvider(&#39;external&#39;), keepInArray(...))</code>.</p>

<ul>
<li><strong>Arguments</strong><ul>
<li><code>{String} arrayName</code></li>
<li><code>{Array&lt; String &gt;} fieldNames</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>arrayName</code></td>
<td><code>String</code></td>
<td></td>
<td>Field name containing an array of objects. Dot notation is supported.</td>
</tr>
<tr>
<td><code>fieldNames</code></td>
<td><code>Array&lt; String &gt;</code></td>
<td></td>
<td>Field names to keep in each object. Dot notation is supported.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; keepInArray &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line">  </span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">  create: keepInArray(<span class="string">'users'</span>, [<span class="string">'name'</span>, <span class="string">'dept'</span>, <span class="string">'address.city'</span>]),</span><br><span class="line">  find: keepInArray(<span class="string">'account.users'</span>, [<span class="string">'name'</span>, <span class="string">'dept'</span>, <span class="string">'address.city'</span>]),</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>Update either <code>context.data</code> (before hook) or <code>context.result[.data]</code> (after hook).<br>Their values are returned if they are not an object, so a <code>null</code> value is supported.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/keep-in-array.js" target="_blank" rel="external">keepInArray</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20keepInArray&body=Comment%20-%20Hooks%20-%20keepInArray" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="keepquery">keepQuery( ‚Ä¶fieldNames )</h3>

Keep certain fields in the query object, deleting the rest.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/keep-query.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Query%20object">Query object</a></td>
  </tr>
  </tbody>
  </table>
<p class="tip">The keepQuery hook will remove any fields not specified even if the service is being called from the server. You may want to condition the hook to run only for external transports, e.g. <code>iff(isProvider(&#39;external&#39;), keepQuery(...))</code>.</p>


  <ul><li>
    <strong>Arguments</strong>
    <ul><li>
      <code>{Array < String >} fieldNames</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>fieldNames</code></td>
    <td style="text-align:center">dot notation</td>
    <td style="text-align:left">The only fields you want to keep in the query object.</td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; keepQuery &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line">  </span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">  create: keepQuery(<span class="string">'name'</span>, <span class="string">'address.city'</span>),</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>Updates <code>context.params.query</code>.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/keep-query.js" target="_blank" rel="external">keepQuery</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Query%20object">Query object</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20keepQuery&body=Comment%20-%20Hooks%20-%20keepQuery" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="keepinarray">keepQueryInArray( arrayName, fieldNames )</h3>

Keep certain fields in a nested array inside the query object, deleting the rest.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/keep-query-in-array.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Query%20object">Query object</a></td>
  </tr>
  </tbody>
  </table>
<p class="tip">The keepQueryInArray hook will remove any fields not specified even if the service is being called from the server. You may want to condition the hook to run only for external transports, e.g. <code>iff(isProvider(&#39;external&#39;), keepQueryInArray(...))</code>.</p>


  <ul><li>
    <strong>Arguments</strong>
    <ul><li>
      <code>{Array < String >} fieldNames</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>fieldNames</code></td>
    <td style="text-align:center">dot notation</td>
    <td style="text-align:left">The only fields you want to keep in a nested array inside the query object.</td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{String} arrayName</code></li>
<li><code>{Array&lt; String &gt;} fieldNames</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>arrayName</code></td>
<td><code>String</code></td>
<td></td>
<td>Field name containing an array of objects. Dot notation is supported.</td>
</tr>
<tr>
<td><code>fieldNames</code></td>
<td><code>Array&lt; String &gt;</code></td>
<td></td>
<td>Field names to keep in each object. Dot notation is supported.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; keepQueryInArray &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line">  </span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  find: keepQueryInArray(<span class="string">'$or'</span>, [<span class="string">'name'</span>, <span class="string">'dept'</span>, <span class="string">'address.city'</span>]),</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>Updates <code>context.params.query</code>.<br>Their values are returned if they are not an object, so a <code>null</code> value is supported.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/keep-query-in-array.js" target="_blank" rel="external">keepQueryInArray</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Query%20object">Query object</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20keepQueryInArray&body=Comment%20-%20Hooks%20-%20keepQueryInArray" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="lowercase">lowerCase( ‚Ä¶ fieldNames )</h3>

Convert certain field values to lower case.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center">create, update, patch</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/lower-case.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a></td>
  </tr>
    <tr>
      <td style="text-align:center"></td>
      <td style="text-align:center">yes</td>
      <td style="text-align:center">all</td>
    </tr>
  </tbody>
  </table>

  <ul><li>
    <strong>Arguments</strong>
    <ul><li>
      <code>{Array < String >} fieldNames</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>fieldNames</code></td>
    <td style="text-align:center">dot notation</td>
    <td style="text-align:left">The fields in the record(s) whose values are converted to lower case.</td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; lowerCase &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  create: lowerCase(<span class="string">'email'</span>, <span class="string">'username'</span>, <span class="string">'div.dept'</span>)</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>Update either <code>context.data</code> (before hook) or <code>context.result[.data]</code> (after hook).</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/lower-case.js" target="_blank" rel="external">lowerCase</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20lowerCase&body=Comment%20-%20Hooks%20-%20lowerCase" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="mongokeys">mongoKeys(ObjectID, keys)</h3>

Wrap MongoDB foreign keys in ObjectID.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">no</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/mongo-keys.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-MongoDB%20specific">MongoDB specific</a>, <a href="#tag-Relations">Relations</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{Function} ObjectID</code></li>
<li><code>{Array &lt; String &gt;} foreignKeyNames</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ObjectID</code></td>
<td style="text-align:center"><code>Function</code></td>
<td>-</td>
<td><code>require(&#39;mongodb&#39;).ObjectID</code> or equivalent.</td>
</tr>
<tr>
<td><code>foreignKeyNames</code></td>
<td style="text-align:center"><code>Array &lt; String &gt;</code> dot notation allowed</td>
<td>-</td>
<td>Field names of the foreign keys. </td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; ObjectID = <span class="built_in">require</span>(<span class="string">'mongodb'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; mongoKeys &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Comment Schema</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  _id,</span></span><br><span class="line"><span class="comment">  body,</span></span><br><span class="line"><span class="comment">  authorId,   // User creating this Comment</span></span><br><span class="line"><span class="comment">  postId,     // Comment is for this Post</span></span><br><span class="line"><span class="comment">  edit: &#123;</span></span><br><span class="line"><span class="comment">    reason,</span></span><br><span class="line"><span class="comment">    editorId, // User last editing Comment</span></span><br><span class="line"><span class="comment">  )</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> foreignKeys = [</span><br><span class="line"> <span class="string">'_id'</span>, <span class="string">'authorId'</span>, <span class="string">'postId'</span>, <span class="string">'edit.editorId'</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  find: mongoKeys(ObjectID, foreignKeys)  </span><br><span class="line">&#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage</span></span><br><span class="line">comment.find(&#123; <span class="attr">query</span>: &#123; <span class="attr">postId</span>: <span class="string">'111111111111'</span> &#125; &#125;)             <span class="comment">// Get all Comments for the Post.</span></span><br><span class="line">comment.find(&#123; <span class="attr">query</span>: &#123; <span class="attr">authorId</span>: &#123; <span class="attr">$in</span>: [...] &#125; &#125; &#125;)           <span class="comment">// Get all Comments from these authors.</span></span><br><span class="line">comment.find(&#123; <span class="attr">query</span>: &#123; <span class="attr">edit</span>: &#123; <span class="attr">editorId</span>: &#123; <span class="attr">$in</span>: [...] &#125; &#125; &#125; &#125;) <span class="comment">// Get all comments edited by these editors.</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>In MongoDB, foreign keys must be wrapped in ObjectID when used in a query, e.g. <code>comment.find({ query: { authorId: new ObjectID(&#39;111111111111&#39;) } })</code>.</p>
<p><code>mongoKeys</code> automates this, given the field names of all the foreign keys in the schema. This reduces the boilerplate cluuter and reduces the chance of bugs occurring.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/mongo-keys.js" target="_blank" rel="external">mongoKeys</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-MongoDB%20specific">MongoDB specific</a>, <a href="#tag-Relations">Relations</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20mongoKeys&body=Comment%20-%20Hooks%20-%20mongoKeys" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="paramsFromClient">paramsFromClient( ‚Ä¶whitelist )</h3>

Pass <code>context.params</code> from client to server. Server hook.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/params-from-client.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Calling%20services">Calling services</a>, <a href="#tag-Client%2Fserver">Client/server</a>, <a href="#tag-Coding">Coding</a>, <a href="#tag-Transport">Transport</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{Array&lt; String &gt; | String} whitelist</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>whitelist</code></td>
<td style="text-align:center">dot notation</td>
<td></td>
<td>Names of the props permitted to be in <code>context.params</code>. Other props are ignored. This is a security feature.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// client</span></span><br><span class="line"><span class="keyword">const</span> &#123; paramsForServer &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line">service.update(id, data, paramsForServer(&#123;</span><br><span class="line">  query: &#123; <span class="attr">dept</span>: <span class="string">'a'</span> &#125;, <span class="attr">populate</span>: <span class="string">'po-1'</span>, <span class="attr">serialize</span>: <span class="string">'po-mgr'</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// server</span></span><br><span class="line"><span class="keyword">const</span> &#123; paramsFromClient &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">    all: [</span><br><span class="line">      paramsFromClient(<span class="string">'populate'</span>, <span class="string">'serialize'</span>, <span class="string">'otherProp'</span>),</span><br><span class="line">      myHook</span><br><span class="line">    ]</span><br><span class="line">&#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// myHook's `context.params` will now be</span></span><br><span class="line"><span class="comment">// &#123; query: &#123; dept: 'a' &#125;, populate: 'po-1', serialize: 'po-mgr' &#125; &#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>By default, only the <code>context.params.query</code> object is transferred from a Feathers client to the server, for security among other reasons. However you can explicitly transfer other <code>context.params</code> props with the client utility function <code>paramsForServer</code> in conjunction with the <code>paramsFromClient</code> hook on the server.</p>
<p>This technique also works for service calls made on the server.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/params-from-client.js" target="_blank" rel="external">paramsFromClient</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Calling%20services">Calling services</a>, <a href="#tag-Client%2Fserver">Client/server</a>, <a href="#tag-Coding">Coding</a>, <a href="#tag-Transport">Transport</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20paramsFromClient&body=Comment%20-%20Hooks%20-%20paramsFromClient" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="populate">populate( options )</h3>

Join related records.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"><a href="guide.html#populate">populate</a></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/populate.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Relations">Relations</a></td>
  </tr>
  </tbody>
  </table>
<blockquote>
<p><code>fastJoin</code> is preferred over using <code>populate</code>.</p>
</blockquote>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><p><code>{Object} options</code></p>
<ul>
<li><p><code>{Object | Function} schema</code></p>
<ul>
<li><code>{String} service</code></li>
<li><code>{any} [ permissions ]</code></li>
<li><code>{Array&lt; Object &gt; | Object} include</code><ul>
<li><code>{String} service</code></li>
<li><code>{String} [ nameAs ]</code></li>
<li><code>{String} [ parentField ]</code></li>
<li><code>{String} [ childField]</code></li>
<li><code>{String} [ permissions ]</code></li>
<li><code>{Object} [ query ]</code></li>
<li><code>{Function} [ select ]</code></li>
<li><code>{Boolean} [ asArray ]</code></li>
<li><code>{Boolean | Number} [ paginate ]</code></li>
<li><code>{Boolean} [ useInnerPopulate ]</code></li>
<li><code>{undefined}} [ provider ]</code></li>
<li><code>{Array&lt; Object &gt; | Object} include</code><ul>
<li>‚Ä¶</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code>{Function} [ checkPermissions ]</code></p>
</li>
<li><code>{Boolean} [ profile ]</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>options</code></td>
<td><code>Object</code></td>
<td></td>
<td>Options.</td>
</tr>
<tr>
<td><code>schema</code></td>
<td><code>Object</code> <code>Function</code></td>
<td><code>(context, options)</code> <code>=&gt; {}</code></td>
<td>Info on how to join records.</td>
</tr>
<tr>
<td><code>checkPermissions</code></td>
<td><code>Function</code></td>
<td>no permission check</td>
<td>Check if call allowed joins.</td>
</tr>
<tr>
<td><code>profile</code></td>
<td><code>Boolean</code></td>
<td><code>false</code></td>
<td>If profile info is to be gathered.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>schema</code></th>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><code>service</code></td>
<td><code>String</code></td>
<td></td>
<td>The name of the service providing the items, actually its path.</td>
</tr>
<tr>
<td></td>
<td><code>nameAs</code></td>
<td>dot notation</td>
<td><code>service</code></td>
<td>Where to place the items from the join</td>
</tr>
<tr>
<td></td>
<td><code>parentField</code></td>
<td>dot notation</td>
<td></td>
<td>The name of the field in the parent item for the relation.</td>
</tr>
<tr>
<td></td>
<td><code>childField</code></td>
<td>dot notation if database supports it</td>
<td></td>
<td>The name of the field in the child item for the relation. Dot notation is allowed and will result in a query like <code>{ &#39;name.first&#39;:</code> <code>&#39;John&#39; }</code> which is not suitable for all DBs. You may use query or select to create a query suitable for your DB.</td>
</tr>
<tr>
<td></td>
<td><code>permissions</code></td>
<td><code>any</code></td>
<td>no permission check</td>
<td>Who is allowed to perform this join. See <code>checkPermissions</code> above.</td>
</tr>
<tr>
<td></td>
<td><code>query</code></td>
<td><code>Object</code></td>
<td></td>
<td>An object to inject into <code>context.params.query</code>.</td>
</tr>
<tr>
<td></td>
<td><code>select</code></td>
<td><code>Function</code></td>
<td><code>(context,</code> <code>parentItem,</code> <code>depth)</code> <code>=&gt; {}</code></td>
<td>A function whose result is injected into the query.</td>
</tr>
<tr>
<td></td>
<td><code>asArray</code></td>
<td><code>Boolean</code></td>
<td><code>false</code></td>
<td>Force a single joined item to be stored as an array.</td>
</tr>
<tr>
<td></td>
<td><code>paginate</code></td>
<td><code>Boolean</code> <code>Number</code></td>
<td><code>false</code></td>
<td>Controls pagination for this service.</td>
</tr>
<tr>
<td></td>
<td><code>useInnerPopulate</code></td>
<td><code>Boolean</code></td>
<td><code>false</code></td>
<td>Perform any <code>populate</code> or <code>fastJoin</code> registered on this service.</td>
</tr>
<tr>
<td></td>
<td><code>provider</code></td>
<td><code>undefined</code></td>
<td></td>
<td>Call the service as the server, not with the client‚Äôs transport.</td>
</tr>
<tr>
<td></td>
<td><code>include</code></td>
<td><code>Array&lt;</code> <code>Object &gt;</code> or <code>Object</code></td>
<td></td>
<td>Continue recursively join records to these records.</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Read the <a href="guide.html#populate">guide</a> for more information on the arguments.</p>
</blockquote>
<ul>
<li><p><strong>Examples</strong></p>
<ul>
<li>1:1 relationship</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// users like &#123; _id: '111', name: 'John', roleId: '555' &#125;</span></span><br><span class="line"><span class="comment">// roles like &#123; _id: '555', permissions: ['foo', bar'] &#125;</span></span><br><span class="line"><span class="keyword">import</span> &#123; populate &#125; <span class="keyword">from</span> <span class="string">'feathers-hooks-common'</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> userRoleSchema = &#123;</span><br><span class="line">  include: &#123;</span><br><span class="line">    service: <span class="string">'roles'</span>,</span><br><span class="line">    nameAs: <span class="string">'role'</span>,</span><br><span class="line">    parentField: <span class="string">'roleId'</span>,</span><br><span class="line">    childField: <span class="string">'_id'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line">app.service(<span class="string">'users'</span>).hooks(&#123;</span><br><span class="line">  after: &#123;</span><br><span class="line">    all: populate(&#123; <span class="attr">schema</span>: userRoleSchema &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// result like</span></span><br><span class="line"><span class="comment">// &#123; _id: '111', name: 'John', roleId: '555',</span></span><br><span class="line"><span class="comment">//   role: &#123; _id: '555', permissions: ['foo', bar'] &#125; &#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>1:n relationship</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// users like &#123; _id: '111', name: 'John', roleIds: ['555', '666'] &#125;</span></span><br><span class="line"><span class="comment">// roles like &#123; _id: '555', permissions: ['foo', 'bar'] &#125;</span></span><br><span class="line"><span class="keyword">const</span> userRolesSchema = &#123;</span><br><span class="line">  include: &#123;</span><br><span class="line">    service: <span class="string">'roles'</span>,</span><br><span class="line">    nameAs: <span class="string">'roles'</span>,</span><br><span class="line">    parentField: <span class="string">'roleIds'</span>,</span><br><span class="line">    childField: <span class="string">'_id'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">usersService.hooks(&#123;</span><br><span class="line">  after: &#123;</span><br><span class="line">    all: populate(&#123; <span class="attr">schema</span>: userRolesSchema &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// result like</span></span><br><span class="line"><span class="comment">// &#123; _id: '111', name: 'John', roleIds: ['555', '666'], roles: [</span></span><br><span class="line"><span class="comment">//   &#123; _id: '555', permissions: ['foo', 'bar'] &#125;</span></span><br><span class="line"><span class="comment">//   &#123; _id: '666', permissions: ['fiz', 'buz'] &#125;</span></span><br><span class="line"><span class="comment">// ]&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>n:1 relationship</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// posts like &#123; _id: '111', body: '...' &#125;</span></span><br><span class="line"><span class="comment">// comments like &#123; _id: '555', text: '...', postId: '111' &#125;</span></span><br><span class="line"><span class="keyword">const</span> postCommentsSchema = &#123;</span><br><span class="line">  include: &#123;</span><br><span class="line">    service: <span class="string">'comments'</span>,</span><br><span class="line">    nameAs: <span class="string">'comments'</span>,</span><br><span class="line">    parentField: <span class="string">'_id'</span>,</span><br><span class="line">    childField: <span class="string">'postId'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line">postService.hooks(&#123;</span><br><span class="line">  after: &#123;</span><br><span class="line">    all: populate(&#123; <span class="attr">schema</span>: postCommentsSchema &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// result like</span></span><br><span class="line"><span class="comment">// &#123; _id: '111', body: '...' &#125;, comments: [</span></span><br><span class="line"><span class="comment">//   &#123; _id: '555', text: '...', postId: '111' &#125;</span></span><br><span class="line"><span class="comment">//   &#123; _id: '666', text: '...', postId: '111' &#125;</span></span><br><span class="line"><span class="comment">// ]&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Multiple and recursive includes</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">  service: <span class="string">'...'</span>,</span><br><span class="line">  permissions: <span class="string">'...'</span>,</span><br><span class="line">  include: [</span><br><span class="line">    &#123;</span><br><span class="line">      service: <span class="string">'users'</span>,</span><br><span class="line">      nameAs: <span class="string">'authorItem'</span>,</span><br><span class="line">      parentField: <span class="string">'author'</span>,</span><br><span class="line">      childField: <span class="string">'id'</span>,</span><br><span class="line">      include: [ ... ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      service: <span class="string">'comments'</span>,</span><br><span class="line">      parentField: <span class="string">'id'</span>,</span><br><span class="line">      childField: <span class="string">'postId'</span>,</span><br><span class="line">      query: &#123;</span><br><span class="line">        $limit: <span class="number">5</span>,</span><br><span class="line">        $select: [<span class="string">'title'</span>, <span class="string">'content'</span>, <span class="string">'postId'</span>],</span><br><span class="line">        $sort: &#123;<span class="attr">createdAt</span>: <span class="number">-1</span>&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      select: <span class="function">(<span class="params">hook, parent, depth</span>) =&gt;</span> (&#123; <span class="attr">$limit</span>: <span class="number">6</span> &#125;),</span><br><span class="line">      asArray: <span class="literal">true</span>,</span><br><span class="line">      provider: <span class="literal">undefined</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      service: <span class="string">'users'</span>,</span><br><span class="line">      permissions: <span class="string">'...'</span>,</span><br><span class="line">      nameAs: <span class="string">'readers'</span>,</span><br><span class="line">      parentField: <span class="string">'readers'</span>,</span><br><span class="line">      childField: <span class="string">'id'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line"><span class="built_in">module</span>.exports.after = &#123;</span><br><span class="line">  all: populate(&#123; schema, checkPermissions, <span class="attr">profile</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>Flexible relationship, similar to the n:1 relationship example above</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// posts like &#123; _id: '111', body: '...' &#125;</span></span><br><span class="line"><span class="comment">// comments like &#123; _id: '555', text: '...', postId: '111' &#125;</span></span><br><span class="line"><span class="keyword">const</span> postCommentsSchema = &#123;</span><br><span class="line">  include: &#123;</span><br><span class="line">    service: <span class="string">'comments'</span>,</span><br><span class="line">    nameAs: <span class="string">'comments'</span>,</span><br><span class="line">    select: <span class="function">(<span class="params">hook, parentItem</span>) =&gt;</span> (&#123; <span class="attr">postId</span>: parentItem._id &#125;),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">postService.hooks(&#123;</span><br><span class="line">  after: &#123;</span><br><span class="line">    all: populate(&#123; <span class="attr">schema</span>: postCommentsSchema &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// result like</span></span><br><span class="line"><span class="comment">// &#123; _id: '111', body: '...' &#125;, comments: [</span></span><br><span class="line"><span class="comment">//   &#123; _id: '555', text: '...', postId: '111' &#125;</span></span><br><span class="line"><span class="comment">//   &#123; _id: '666', text: '...', postId: '111' &#125;</span></span><br><span class="line"><span class="comment">// ]&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>We often want to combine rows from two or more tables based on a relationship between them. The <code>populate</code> hook will select records that have matching values in both tables.</p>
<p><code>populate</code> supports 1:1, 1:n and n:1 relationships. It can provide performance profile information.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/populate.js" target="_blank" rel="external">populate</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: Guide <a href="guide.html#populate">populate</a> and tags <a href="#tag-Relations">Relations</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20populate&body=Comment%20-%20Hooks%20-%20populate" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="preventchanges">preventChanges( ifThrow, ‚Ä¶fieldNames )</h3>

Prevent <code>patch</code> service calls from changing certain fields.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">no</td>
    <td style="text-align:center">patch</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/prevent-changes.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Service%20methods">Service methods</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{Boolean} ifThrow</code></li>
<li><code>{Array &lt; String &gt;} fieldNames</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ifThrow</code></td>
<td style="text-align:center"><code>Boolean</code></td>
<td></td>
<td>Deletes any <code>fieldNames</code> if <code>false</code>; throws if <code>true</code>.</td>
</tr>
<tr>
<td><code>fieldNames</code></td>
<td style="text-align:center">dot notation</td>
<td></td>
<td>The fields names which may not be patched.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; preventChanges &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  patch: preventChanges(<span class="literal">true</span>, <span class="string">'security.badge'</span>)</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>Consider using validateSchema if you would rather specify which fields are allowed to change.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/prevent-changes.js" target="_blank" rel="external">preventChanges</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Service%20methods">Service methods</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20preventChanges&body=Comment%20-%20Hooks%20-%20preventChanges" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="required">required(‚Ä¶fieldNames)</h3>

Check selected fields exist and are not falsey. Numeric 0 is acceptable.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">no</td>
    <td style="text-align:center">create, update, patch</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/required.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Services">Services</a>, <a href="#tag-Validation">Validation</a></td>
  </tr>
  </tbody>
  </table>

  <ul><li>
    <strong>Arguments</strong>
    <ul><li>
      <code>{Array < String >} fieldNames</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>fieldNames</code></td>
    <td style="text-align:center">dot notation</td>
    <td style="text-align:left">These fields must exist and not be falsey. Numeric 0 is acceptable.</td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; required &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  all: required(<span class="string">'email'</span>, <span class="string">'password'</span>)</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/required.js" target="_blank" rel="external">required</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Services">Services</a>, <a href="#tag-Validation">Validation</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20required&body=Comment%20-%20Hooks%20-%20required" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="runparallel">runParallel( hookFunc, clone [, depth ] )</h3>

Run a hook in parallel to the other hooks and the service call.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/run-parallel.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Client%2Fserver">Client/server</a>, <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Performance">Performance</a>, <a href="#tag-Services">Services</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{Function} hookFunc</code></li>
<li><code>{Function} clone</code></li>
<li><code>{Number} [ depth ]</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th style="text-align:center">Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hookFunc</code></td>
<td style="text-align:center"><code>Function</code></td>
<td style="text-align:center"></td>
<td>The hook function to run in parallel to the rest of the service call.</td>
</tr>
<tr>
<td><code>clone</code></td>
<td style="text-align:center"><code>Function</code></td>
<td style="text-align:center"></td>
<td>Function to deep clone its only parameter.</td>
</tr>
<tr>
<td><code>depth</code></td>
<td style="text-align:center"><code>Number</code></td>
<td style="text-align:center">6</td>
<td>Depth to which <code>context</code> is to be cloned. 0 does not clone. A depth of 5 would clone <code>context.result.data.[].item</code>.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; runParallel &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"><span class="keyword">const</span> clone = <span class="built_in">require</span>(<span class="string">'clone'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendEmail</span>(<span class="params">...</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">context</span> =&gt;</span> &#123; ... &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">  create: runParallel(sendEmail(...), clone)</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p><code>hookFunc</code> is scheduled with a <code>setTimeout</code>. The next hook starts immediately.</p>
<p>The hook was provided by bedeoverend. Thank you.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/run-parallel.js" target="_blank" rel="external">runParallel</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Client%2Fserver">Client/server</a>, <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Performance">Performance</a>, <a href="#tag-Services">Services</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20runParallel&body=Comment%20-%20Hooks%20-%20runParallel" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="serialize">serialize( schema )</h3>

Prune values from related records. Calculate new values.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/serialize.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Relations">Relations</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Object | Function} schema</code><ul>
<li><code>{Array&lt; String&gt; | String} only</code></li>
<li><code>{Array&lt; String&gt; | String} exclude</code></li>
<li><code>[fieldName]: {Object} schema</code></li>
<li><code>{Object} computed</code><ul>
<li><code>[fieldName]: {Function} computeFunc</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>schema</code></td>
<td style="text-align:center"><code>Object</code> <code>Function</code></td>
<td><code>context</code> <code>=&gt; schema</code></td>
<td>How to serialize the items.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>schema</code></th>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><code>only</code></td>
<td style="text-align:center"><code>Array&lt;</code> <code>String&gt;</code> or <code>String</code></td>
<td></td>
<td>The names of the fields to keep in each item. The names for included sets of items plus <code>_include</code> and <code>_elapsed</code> are not removed by <code>only</code>.</td>
</tr>
<tr>
<td></td>
<td><code>exclude</code></td>
<td style="text-align:center"><code>Array&lt;</code> <code>String&gt;</code> or <code>String</code></td>
<td></td>
<td>The names of fields to drop in each item. You may drop, at your own risk, names of included sets of items, <code>_include</code> and <code>_elapsed</code>.</td>
</tr>
<tr>
<td></td>
<td><code>computed</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The new names you want added and how to compute their values.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>schema</code> <code>.computed</code></th>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><code>fieldName</code></td>
<td style="text-align:center"><code>String</code></td>
<td></td>
<td>The name of the field to add to the records.</td>
</tr>
<tr>
<td></td>
<td><code>computeFunnc</code></td>
<td style="text-align:center"><code>Function</code></td>
<td><code>(record,</code> <code>context)</code> <code>=&gt; value</code></td>
<td>Function to calculate the computed value. <code>item</code>: The item with all its initial values, plus all of its included items. The function can still reference values which will be later removed by only and exclude. <code>context</code>: The context passed to <code>serialize</code>.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<p>The schema reflects the structure of the populated records. The base records for this example have included <code>post</code> records, which themselves have included <code>authorItem</code>, <code>readersInfo</code> and <code>commentsInfo</code> records.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">  only: <span class="string">'updatedAt'</span>,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    commentsCount: <span class="function">(<span class="params">recommendation, hook</span>) =&gt;</span> recommendation.post.commentsInfo.length,</span><br><span class="line">  &#125;,</span><br><span class="line">  post: &#123;</span><br><span class="line">    exclude: [<span class="string">'id'</span>, <span class="string">'createdAt'</span>, <span class="string">'author'</span>, <span class="string">'readers'</span>],</span><br><span class="line">    authorItem: &#123;</span><br><span class="line">      exclude: [<span class="string">'id'</span>, <span class="string">'password'</span>, <span class="string">'age'</span>],</span><br><span class="line">      computed: &#123;</span><br><span class="line">        isUnder18: <span class="function">(<span class="params">authorItem, hook</span>) =&gt;</span> authorItem.age &lt; <span class="number">18</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    readersInfo: &#123;</span><br><span class="line">      exclude: <span class="string">'id'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    commentsInfo: &#123;</span><br><span class="line">      only: [<span class="string">'title'</span>, <span class="string">'content'</span>],</span><br><span class="line">      exclude: <span class="string">'content'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">purchaseOrders.after(&#123;</span><br><span class="line">  all: [ populate( ... ), serialize(schema) ]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">  <span class="keyword">get</span>: [ populate( ... ), serialize(schema) ],</span><br><span class="line">  find: [ fastJoin( ... ), serialize(schema) ]</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>Works with <code>fastJoin</code> and <code>populate</code>.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/serialize.js" target="_blank" rel="external">serialize</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Relations">Relations</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20serialize&body=Comment%20-%20Hooks%20-%20serialize" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="setnow">setNow( ‚Ä¶fieldNames )</h3>

Create/update certain fields to the current date-time.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/set-now.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a></td>
  </tr>
  </tbody>
  </table>

  <ul><li>
    <strong>Arguments</strong>
    <ul><li>
      <code>{Array < String >} fieldNames</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>fieldNames</code></td>
    <td style="text-align:center">dot notation</td>
    <td style="text-align:left">The fields that you want to add or set to the current date-time.</td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; setNow &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  create: setNow(<span class="string">'createdAt'</span>, <span class="string">'updatedAt'</span>)</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>Update either <code>context.data</code> (before hook) or <code>context.result[.data]</code> (after hook).</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/set-now.js" target="_blank" rel="external">setNow</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20setNow&body=Comment%20-%20Hooks%20-%20setNow" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="setslug">setSlug( slug [, fieldName] )</h3>

Fix slugs in URL, e.g. <code>/stores/:storeId</code>.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/set-slug.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-REST">REST</a>, <a href="#tag-Transport">Transport</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{String} slug</code></li>
<li><code>{String} [ fieldName ]</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>slug</code></td>
<td style="text-align:center"><code>String</code></td>
<td></td>
<td>The slug as it appears in the route, e.g. <code>storeId</code> for<code>/stores/:storeId/candies</code>.</td>
</tr>
<tr>
<td><code>fieldName</code></td>
<td style="text-align:center"><code>String</code></td>
<td><code>query[slug]</code></td>
<td>The field to contain the slug value.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; setSlug &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  all: [ hooks.setSlug(<span class="string">'storeId'</span>) ]</span><br><span class="line">&#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// `context.params.query` will always be normalized,</span></span><br><span class="line"><span class="comment">// e.g. `&#123; size: 'large', storeId: '123' &#125;`</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>A service may have a slug in its URL, e.g. <code>storeId</code> in <code>app.use(</code> <code>&#39;/stores/:storeId/candies&#39;,</code> <code>new Service());</code>. The service gets slightly different values depending on the transport used by the client.</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>transport</th>
<th><code>hook.data</code> <code>.storeId</code></th>
<th><code>hook.params</code> <code>.query</code></th>
<th>code run on client</th>
</tr>
</thead>
<tbody>
<tr>
<td>socketio</td>
<td><code>undefined</code></td>
<td><code>{ size: &#39;large&#39;,</code> <code>storeId: &#39;123&#39; }</code></td>
<td><code>candies.create({ name: &#39;Gummi&#39;,qty: 100 },</code> <code>{ query: { size: &#39;large&#39;, storeId: &#39;123&#39; } })</code></td>
</tr>
<tr>
<td>rest</td>
<td><code>:storeId</code></td>
<td>same as above</td>
<td>same as above</td>
</tr>
<tr>
<td>raw HTTP</td>
<td><code>123</code></td>
<td><code>{ size: &#39;large&#39; }</code></td>
<td><code>fetch(&#39;/stores/123/candies?size=large&#39;, ..</code></td>
</tr>
</tbody>
</table>
<p>This hook normalizes the difference between the transports.</p>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/set-slug.js" target="_blank" rel="external">setSlug</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-REST">REST</a>, <a href="#tag-Transport">Transport</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20setSlug&body=Comment%20-%20Hooks%20-%20setSlug" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="sifter">sifter( siftFunc )</h3>

Filter data or result records using a MongoDB-like selection syntax.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">no</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">find</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/sifter.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Relations">Relations</a>, <a href="#tag-Service%20methods">Service methods</a>, <a href="#tag-Services">Services</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{Function} siftFunc</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>siftFunc</code></td>
<td style="text-align:center"><code>Function</code></td>
<td></td>
<td>Function similar to <code>context =&gt; sift(mongoQueryObj)</code>. Information about the mongoQueryObj syntax is available at <a href="https://github.com/crcn/sift.js" target="_blank" rel="noopener">crcn/sift</a>.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sift = <span class="built_in">require</span>(<span class="string">'sift'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; sifter &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> selectCountry = <span class="function"><span class="params">hook</span> =&gt;</span> sift(&#123; <span class="string">'address.country'</span>: hook.params.country &#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  find: sifter(selectCountry),</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sift = <span class="built_in">require</span>(<span class="string">'sift'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; sifter &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> selectCountry = <span class="function"><span class="params">country</span> =&gt;</span> <span class="function"><span class="params">()</span> =&gt;</span> sift(&#123; <span class="attr">address</span> : &#123; <span class="attr">country</span>: country &#125; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  find: sifter(selectCountry(<span class="string">'Canada'</span>)),</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>Details</strong></p>
<p>All official Feathers database adapters support a common way for querying, sorting, limiting and selecting find method calls. These are limited to what is commonly supported by all the databases.</p>
<p>The <code>sifter</code> hook provides an extensive MongoDB-like selection capabilities, and it may be used to more extensively select records.</p>
<p><code>sifter</code> filters the result of a find call. Therefore more records will be physically read than needed. You can use the Feathers database adapters query to reduce this number.`</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/sifter.js" target="_blank" rel="external">sifter</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Relations">Relations</a>, <a href="#tag-Service%20methods">Service methods</a>, <a href="#tag-Services">Services</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20sifter&body=Comment%20-%20Hooks%20-%20sifter" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="skipremaininghooks">skipRemainingHooks( predicate )</h3>

Conditionally skip running all remaining hooks.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/skip-remaining-hooks.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Services">Services</a></td>
  </tr>
  </tbody>
  </table>
  <p class="tip">The service call will only be skipped if <code>context.result</code> has been set manually.</p>

<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{Function | Boolean} predicate</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>predicate</code></td>
<td style="text-align:center"><code>Function</code>, <code>Boolean</code></td>
<td><code>content =&gt; content.result</code></td>
<td>A predicate. If true the remaining hooks are skipped. The default checks if <code>context.result</code> has been set.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<p>Skip the remaining hooks if the record was found in the cache.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; cache, skipRemainingHooks &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  <span class="keyword">get</span>: [cache(new Map()), skipRemainingHooks()] </span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
<p>Skip all the <code>after</code> hooks if the service call was initiated by the server.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">after</span>: &#123;</span><br><span class="line">  all: [skipRemainingHooks(<span class="function"><span class="params">context</span> =&gt;</span> !context.provider)] </span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>The remaining before hooks will be skipped is you use <code>shipRemainingHooks</code> as a before hook. However the after hooks will still be run.</p>
<p><code>shipRemainingHooks</code> skips the remaining hooks in the before, after or error hooks. It will skip the remaining hooks if used within the <code>combine</code> hook.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/skip-remaining-hooks.js" target="_blank" rel="external">skipRemainingHooks</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Services">Services</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20skipRemainingHooks&body=Comment%20-%20Hooks%20-%20skipRemainingHooks" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="softdelete">softDelete( fieldName )</h3>

  <p class="tip">DEPRECATED. Use the <strong>softDelete2</strong> hook instead. It is a noteable improvement over softDelete.</p>

Flag records as logically deleted instead of physically removing them. Deprecated.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">no</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/soft-delete.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Services">Services</a></td>
  </tr>
  </tbody>
  </table>
  <p class="tip">The softDelete2 hooks must be correctly positioned.</p>

<ul>
<li><strong>Arguments</strong><ul>
<li><code>{String} fieldName</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fieldName</code></td>
<td style="text-align:center"><code>String</code></td>
<td><code>&#39;deleted&#39;</code></td>
<td>The name of the field for the logically deleted flag.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; softDelete &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"><span class="keyword">const</span> dept = app.service(<span class="string">'departments'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  all: softDelete(),</span><br><span class="line">&#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// will throw if item is marked deleted.</span></span><br><span class="line">dept.get(<span class="number">0</span>).then(...)</span><br><span class="line"></span><br><span class="line"><span class="comment">// methods can be run avoiding softDelete handling</span></span><br><span class="line">dept.get(<span class="number">0</span>, &#123; <span class="attr">query</span>: &#123; <span class="attr">$disableSoftDelete</span>: <span class="literal">true</span> &#125;&#125;).then(...)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Detail</strong></p>
<p>Marks items as <code>{ deleted: true }</code> instead of physically removing them. This is useful when you want to discontinue use of, say, a department, but you have historical information which continues to refer to the discontinued department.</p>
<p>The hook performs its own preliminary <code>get</code> call if the original service call was not itself a <code>get</code>. The calling params for this prelinary <code>get</code> are formed from the original calling context:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123; <span class="attr">query</span>: &#123;&#125;,</span><br><span class="line">  provider: context.params.provider, <span class="comment">// Keep the same transport.</span></span><br><span class="line">  _populate: <span class="string">'skip'</span>, <span class="comment">// Skip any `fastJoin` or `populate` hooks.</span></span><br><span class="line">  authenticated: context.params.authenticated, <span class="comment">// Keep authentication status.</span></span><br><span class="line">  user: context.params.user <span class="comment">// Keep authenticated user information</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
  <p class="tip">The <code>user</code> record is read by feathers-authentication<code>with a</code>get<code>. The</code>softDelete` hook will be run for this call unless it is conditioned to ignore it. This situation raises the most issues for this hook.</p>

  <p class="tip">The hook will not function properly if you remove the <code>deleted</code> flag in your hooks. It has to returned in the record.</p>



  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/soft-delete.js" target="_blank" rel="external">softDelete</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Services">Services</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20softDelete&body=Comment%20-%20Hooks%20-%20softDelete" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="softdelete2">softDelete2( options )</h3>

Flag records as logically deleted instead of physically removing them.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/soft-delete2.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Services">Services</a></td>
  </tr>
  </tbody>
  </table>
  <p class="tip">softDelete2 must be correctly positioned as both a before and an after hook. Refer to the <strong>Details</strong> section and the <strong>Examples</strong>.</p>

<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Object} options</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>options</code></td>
<td style="text-align:center"><code>Object</code></td>
<td><code>{}</code></td>
<td>The options for the hook. The allowed options differ depending on whether the hook is used in before or after.</td>
</tr>
</tbody>
</table>
<p>When used as a before hook:</p>
<table>
<thead>
<tr>
<th><code>options</code></th>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><code>deletedAt</code></td>
<td><code>String</code></td>
<td><code>&#39;deletedAt&#39;</code></td>
<td>The prop name whose value is the time stamp when the record was logically deleted. <code>Date.now()</code> is used as the time stamp.</td>
</tr>
<tr>
<td></td>
<td><code>keepOnCreate</code></td>
<td><code>Boolean</code></td>
<td><code>false</code></td>
<td>The prop <code>deletedAt</code> is set to -1 when a record is created. An option value of <code>true</code> will retain the existing value of <code>deletedAt</code> if one is provided. This is useful when loading a dataset with records.</td>
</tr>
<tr>
<td></td>
<td><code>skipProbeOnGet</code></td>
<td><code>Boolean</code></td>
<td><code>false</code></td>
<td>softDelete2 makes a probing <code>get</code> call to determine if a record is active before mutating it. It makes this probing call even for a <code>get</code> call, though that‚Äôs redundant. An option value of <code>true</code> results in a single <code>get</code> call, improving performance. This however may cause unexpected interactions with other hooks which is why performing the probing call is the default.</td>
</tr>
<tr>
<td></td>
<td><code>allowIgnore</code> <code>DeletedAt</code></td>
<td><code>Boolean</code></td>
<td><code>true</code></td>
<td>Your app usually has to access records even if they are logically deleted. softDelete2 acts like a no-op for calls with <code>params.$ignoreDeletedAt: true</code>. Clients can be prevented from using this with the <code>paramsFromClient</code> hook. If you consider it a security issue that server code is allowed to do this, an option value of <code>false</code> disables this capability in softDelete2.</td>
</tr>
<tr>
<td></td>
<td><code>probeCall</code></td>
<td><code>Function</code></td>
<td>built-in default</td>
<td>A custom function to perform the probing get call. Its signature is <code>(context, options)</code> where <code>options</code> is these options.)</td>
</tr>
<tr>
<td></td>
<td><code>patchCall</code></td>
<td><code>Function</code></td>
<td>built-in default</td>
<td>A custom function to perform the patch call which marks the record as deleted. Its signature is <code>(context, options)</code> where <code>options</code> is these options.)</td>
</tr>
</tbody>
</table>
<p>When used as an after hook:</p>
<table>
<thead>
<tr>
<th><code>options</code></th>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><code>deletedAt</code></td>
<td><code>String</code></td>
<td><code>&#39;deletedAt&#39;</code></td>
<td>It must be specified in the after hook if its specified in the before hook.</td>
</tr>
<tr>
<td></td>
<td><code>skipProbeOnGet</code></td>
<td><code>Boolean</code></td>
<td><code>false</code></td>
<td>It must be specified in the after hook if its specified in the before hook.</td>
</tr>
<tr>
<td></td>
<td><code>allowIgnore</code> <code>DeletedAt</code></td>
<td><code>Boolean</code></td>
<td><code>true</code></td>
<td>It must be specified in the after hook if its specified in the before hook.</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>Examples</strong></li>
</ul>
<p>Usage without authentication:</p>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// On server</span></span><br><span class="line"><span class="keyword">const</span> &#123; softDelete2 &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"><span class="keyword">const</span> posts = app.service(<span class="string">'posts'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  before: &#123;</span><br><span class="line">    all: softDelete2()</span><br><span class="line">  &#125;,</span><br><span class="line">  after: </span><br><span class="line">    all: softDelete2()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// will throw if item is marked deleted.</span></span><br><span class="line"><span class="keyword">const</span> rec = <span class="keyword">await</span> posts.get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// methods can be run avoiding softDelete handling</span></span><br><span class="line"><span class="keyword">const</span> rec = <span class="keyword">await</span> posts.get(<span class="number">0</span>, &#123; <span class="attr">$ignoreDeletedAt</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>Usage with authentication:</p>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// On server</span></span><br><span class="line"><span class="keyword">const</span> &#123; authenticate &#125; = <span class="built_in">require</span>(<span class="string">'@feathersjs/authentication'</span>).hooks;</span><br><span class="line"><span class="keyword">const</span> &#123; hashPassword, protect &#125; = <span class="built_in">require</span>(<span class="string">'@feathersjs/authentication-local'</span>).hooks;</span><br><span class="line"><span class="keyword">const</span> &#123; restrictToOwner &#125; = <span class="built_in">require</span>(<span class="string">'feathers-authentication-hooks'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; softDelete2, paramsFromClient &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> users = app.service(<span class="string">'users'</span>);</span><br><span class="line"><span class="keyword">const</span> posts = app.service(<span class="string">'posts'</span>);</span><br><span class="line"></span><br><span class="line">users.hooks(&#123;</span><br><span class="line">  before: &#123;</span><br><span class="line">    all:    [],</span><br><span class="line">    find:   [                 authenticate(<span class="string">'jwt'</span>), softDelete2() ],</span><br><span class="line">    <span class="keyword">get</span>:    [                 authenticate('jwt'), softDelete2() ],</span><br><span class="line">    create: [ hashPassword(), authenticate('jwt'), softDelete2() ],</span><br><span class="line">    update: [ hashPassword(), authenticate('jwt'), softDelete2() ],</span><br><span class="line">    patch:  [ hashPassword(), authenticate('jwt'), softDelete2() ],</span><br><span class="line">    remove: [                 authenticate('jwt'), softDelete2() ]</span><br><span class="line">  &#125;,</span><br><span class="line">  after: &#123;</span><br><span class="line">    all:    [ protect(<span class="string">'password'</span>), softDelete2() ] <span class="comment">/* Must always be the last 2 hooks */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">posts.hooks(&#123;</span><br><span class="line">  before: &#123;</span><br><span class="line">    all:    [ paramsFromClient(<span class="string">'$ignoreDeletedAt'</span>), authenticate(<span class="string">'jwt'</span>) ],</span><br><span class="line">    <span class="keyword">get</span>:    [ softDelete2(), restrictToOwner(&#123; idField: <span class="string">'id'</span>, <span class="attr">ownerField</span>: <span class="string">'ownerId'</span> &#125;) ],</span><br><span class="line">    create: [ softDelete2(), restrictToOwner(&#123; <span class="attr">idField</span>: <span class="string">'id'</span>, <span class="attr">ownerField</span>: <span class="string">'ownerId'</span> &#125;) ],</span><br><span class="line">    update: [ softDelete2(), restrictToOwner(&#123; <span class="attr">idField</span>: <span class="string">'id'</span>, <span class="attr">ownerField</span>: <span class="string">'ownerId'</span> &#125;) ],</span><br><span class="line">    patch:  [ softDelete2(), restrictToOwner(&#123; <span class="attr">idField</span>: <span class="string">'id'</span>, <span class="attr">ownerField</span>: <span class="string">'ownerId'</span> &#125;) ],</span><br><span class="line">    remove: [ restrictToOwner(&#123; <span class="attr">idField</span>: <span class="string">'id'</span>, <span class="attr">ownerField</span>: <span class="string">'ownerId'</span> &#125;), softDelete2() ]</span><br><span class="line">  &#125;,</span><br><span class="line">  after: &#123;</span><br><span class="line">    all: softDelete2()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// On client</span></span><br><span class="line"><span class="keyword">const</span> &#123; paramsForServer &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common/lib/services/params-for-server'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> app.authenticate(&#123;</span><br><span class="line">  strategy: <span class="string">'local'</span>,</span><br><span class="line">  email: <span class="string">'foo@gmail.com'</span>,</span><br><span class="line">  password: <span class="string">'bar'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> posts = app.service(<span class="string">'posts'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// will throw if item is marked deleted.</span></span><br><span class="line"><span class="keyword">const</span> rec1 = <span class="keyword">await</span> posts.get(<span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// methods can be run avoiding softDelete handling</span></span><br><span class="line"><span class="keyword">const</span> rec2 = <span class="keyword">await</span> posts.get(<span class="number">0</span>, paramsForServer(&#123; <span class="attr">$ignoreDeletedAt</span>: <span class="literal">true</span> &#125;));</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>Detail</strong></p>
<p>softDelete2 makes a probing get call to check if a record is logically deleted before allowing it to be accessed or mutated. It also replaces remove calls with ones to patch <code>deletedAt: Date.now()</code> into the record.</p>
<p>Find calls, plus patch or remove calls with a <code>null</code> id, do not need a probing get. softDelete2 modifies their <code>params.query</code> to ignore logically deleted records.</p>
</li>
<li><p><strong>An issue with hooks</strong></p>
<p>As mentioned, softDelete2 makes get and patch calls. You may want to use the authentication hook <code>restrictToOwner</code>, but that makes its own version of a probing get call. Other hooks, such as <code>stashBefore</code>, also make get calls.</p>
<p>A problem may arise because all such calls run the hooks associated with that call. Let‚Äôs say, for example, the hooks on your get method include <code>fastJoin</code>. The <code>restrictToOwner</code> probing get call will run the <code>fastJoin</code> on its probing get call, degrading performance significantly. You have to find ways of explicitly disabling hooks like <code>fastJoin</code>.</p>
<p>Even worse, the nested running of such hooks can create incompatibilities resulting in errors.</p>
</li>
<li><p><strong>How softDelete2 controls hooks</strong></p>
<p>softDelete2 is run for every call on a service, so its careful to not run unnecessary hooks during its probing get and removal patch calls. The hooks following the before <code>softDelete2()</code> are skipped, as are those following the after <code>softDelete2()</code>. <em>This skipping occurs only for the probing get and removal patch calls. All hooks are executed for the original call.</em> </p>
<p>In the example below: </p>
<ul>
<li>The hooks21 &amp; hooks41 hooks on get and patch are run during the probing get and removing patch.</li>
<li>The hooks22 &amp; hooks42 hooks are not run during those calls.</li>
<li>So on an update: hooks31 (for update), hooks21 (probing get), hooks32 (for update) are run.</li>
<li>So on a remove: hooks51 (for remove), hooks21 (probing get), hooks41 (removal patch) are run.<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  before: &#123;</span><br><span class="line">   find:   [...hooks01, softDelete(), ...hooks02],</span><br><span class="line">   create: [...hooks11, softDelete(), ...hooks12],</span><br><span class="line">   <span class="keyword">get</span>:    [...hooks21, softDelete(), ...hooks22],</span><br><span class="line">   update: [...hooks31, softDelete(), ...hooks32],</span><br><span class="line">   patch:  [...hooks41, softDelete(), ...hooks42],</span><br><span class="line">   remove: [...hooks51, softDelete()] // softDelete must be the last hook run for remove calls.</span><br><span class="line">  &#125;,</span><br><span class="line">  after: &#123;</span><br><span class="line">    all: softDelete2(), <span class="comment">// Must be the first hook run for get or patch calls.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>options.allowIgnoreDeletedAt</strong></p>
<p>softDelete2 will allow access to logically deleted records if the call‚Äôs params includes <code>$ignoreDeletedAt: true</code> while options.allowIgnoreDeletedAt is <code>true</code> (the default). Be careful setting it to <code>false</code> as not even server calls will be able to read logically deleted records.</p>
<p>You can prevent just client calls from using <code>$ignoreDeletedAt: true</code> by not specifying <code>$ignoreDeletedAt</code> in the <a href="#paramsFromClient"><code>paramsFromClient</code></a> hook.</p>
<p>You may need to prevent other hooks from running as well. You can use code similar to</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">iff(<span class="function"><span class="params">context</span> =&gt;</span> !context.params.$ignoreDeletedAt, restrictToOwner(...))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>options.probeCall</strong></p>
<p>The default probing get call function is</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; callingParams, callingParamsDefault &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">defaultProbeCall</span> (<span class="params">context, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> params = callingParams(&#123;</span><br><span class="line">    newProps: &#123; <span class="attr">provider</span>: <span class="literal">undefined</span> &#125;, <span class="attr">hooksToDisable</span>: [<span class="string">'softDelete2'</span>]</span><br><span class="line">  &#125;)(context);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> context.service.get(context.id, params);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>where <code>options</code> is the options provided softDelete2. Its resulting params will be:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">params = &#123;</span><br><span class="line">  authenticated: context.params.authenticated,</span><br><span class="line">  user: context.params.user,</span><br><span class="line">  provider: <span class="literal">undefined</span>,</span><br><span class="line">  $disableSoftDelete2: <span class="literal">true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>You can change the params produced by the default function by calling <a href="#callingparamsdefaults"><code>callingParamsDefaults</code></a>. You can instead provide your own probing call function using options.probeCall.</p>
</li>
<li><p><strong>options.patchCall</strong></p>
<p>The default function to perform the patch call which marks the record as deleted is</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; callingParams, callingParamsDefault &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">defaultPatchCall</span> (<span class="params">context, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> deletedAt = options.deletedAt || defaultDeletedAt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> params = callingParams(&#123;</span><br><span class="line">    query: <span class="built_in">Object</span>.assign(&#123;&#125;, context.params.query, &#123; [deletedAt]: <span class="number">-1</span> &#125;),</span><br><span class="line">    newProps: &#123; <span class="attr">provider</span>: <span class="literal">undefined</span> &#125;,</span><br><span class="line">    hooksToDisable: [<span class="string">'softDelete2'</span>]</span><br><span class="line">  &#125;)(context);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> context.service.patch(context.id, &#123; [deletedAt]: <span class="built_in">Date</span>.now() &#125;, params);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>where <code>options</code> is the options provided softDelete2. Its resulting params will be:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">params = &#123;</span><br><span class="line">  query: &#123; ..., <span class="attr">deletedAt</span>: <span class="number">-1</span> &#125;,</span><br><span class="line">  authenticated: context.params.authenticated,</span><br><span class="line">  user: context.params.user,</span><br><span class="line">  provider: <span class="literal">undefined</span>,</span><br><span class="line">  $disableSoftDelete2: <span class="literal">true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>You can change the params produced by the default function by calling <a href="#callingparamsdefaults"><code>callingParamsDefaults</code></a>. You can instead provide your own probing call function using options.patchCall.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/soft-delete2.js" target="_blank" rel="external">softDelete2</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Services">Services</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20softDelete2&body=Comment%20-%20Hooks%20-%20softDelete2" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="some">some( ‚Ä¶predicates )</h3>

Return the <code>or</code> of a series of sync or async predicate functions.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/some.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Predicates">Predicates</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{Array&lt; Function &gt;} predicates</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>predicates</code></td>
<td style="text-align:center"><code>Array&lt; Function &gt;</code></td>
<td></td>
<td>Functions which take the current hook as a param and return a boolean result.</td>
</tr>
</tbody>
</table>

  <ul><li>
    <strong>Returns</strong>
    <ul><li>
      <code>{Boolean} result</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>result</code></td>
    <td style="text-align:center"><code>Boolean</code></td>
    <td style="text-align:left">The logical or of <code>predicates</code></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; iff, some &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">    create: iff(some(hook1, hook2, ...), hookA, hookB, ...)</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p><code>some</code> is a predicate function for use in conditional hooks. The predicate functions are run in parallel, and <code>true</code> is returned if any predicate returns a truthy value.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/some.js" target="_blank" rel="external">some</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Conditionals">Conditionals</a>, <a href="#tag-Predicates">Predicates</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20some&body=Comment%20-%20Hooks%20-%20some" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="stashbefore">stashBefore( fieldName )</h3>

Stash current value of record, usually before mutating it. Performs a <code>get</code> call.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">no</td>
    <td style="text-align:center">get, update, patch, remove</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/stash-before.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Services">Services</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{String} fieldName</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fieldName</code></td>
<td style="text-align:center"></td>
<td><code>&#39;before&#39;</code></td>
<td>The name of the <code>context.params</code> property to contain the current record value.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; patch &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  patch: stashBefore()</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>The hook always performs its own preliminary <code>get</code> call. If the original service call is also a <code>get</code>, its <code>context.params</code> is used for the preliminary <code>get</code>.</p>
<p>For any other method the calling params are formed from the original calling context:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123; <span class="attr">provider</span>: context.params.provider,</span><br><span class="line">  authenticated: context.params.authenticated,</span><br><span class="line">  user: context.params.user &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/stash-before.js" target="_blank" rel="external">stashBefore</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Services">Services</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20stashBefore&body=Comment%20-%20Hooks%20-%20stashBefore" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="traverse">traverse( transformer [, getObject] )</h3>

Transform fields & objects in place in the record(s) using a recursive walk. Powerful.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/traverse.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Imperative%20API">Imperative API</a>, <a href="#tag-Query%20object">Query object</a>, <a href="#tag-REST">REST</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Function} transformer</code></li>
<li><code>{Function} [ getObject ]</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>transformer</code></td>
<td style="text-align:center"><code>Function</code></td>
<td></td>
<td>Called for every node in every record(s). May change the node in place.</td>
</tr>
<tr>
<td><code>getObject</code></td>
<td style="text-align:center"><code>Function</code></td>
<td><code>context.data</code> or <code>context.result[.data]</code></td>
<td>Function with signature <code>context =&gt; {}</code> which returns the object to traverse.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; traverse &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Trim strings</span></span><br><span class="line"><span class="keyword">const</span> trimmer = <span class="function"><span class="keyword">function</span> (<span class="params">node</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> node === <span class="string">'string'</span>) &#123; <span class="keyword">this</span>.update(node.trim()); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// REST HTTP request may use the string 'null' in its query string.</span></span><br><span class="line"><span class="comment">// Replace these strings with the value null.</span></span><br><span class="line"><span class="keyword">const</span> nuller = <span class="function"><span class="keyword">function</span> (<span class="params">node</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (node === <span class="string">'null'</span>) &#123; <span class="keyword">this</span>.update(<span class="literal">null</span>); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  create: traverse(trimmer),</span><br><span class="line">  find: traverse(nuller, context =&gt; context.params.query)</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>Traverse and transform objects in place by visiting every node on a recursive walk. Any object in the hook may be traversed, including the query object.</p>
<blockquote>
<p><a href="https://github.com/substack/js-traverse" target="_blank" rel="noopener">substack/js-traverse</a> documents the extensive methods and context available to the transformer function.</p>
</blockquote>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/traverse.js" target="_blank" rel="external">traverse</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Imperative%20API">Imperative API</a>, <a href="#tag-Query%20object">Query object</a>, <a href="#tag-REST">REST</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20traverse&body=Comment%20-%20Hooks%20-%20traverse" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="unless">unless( predicate, ‚Ä¶hookFuncs )</h3>

Execute a series of hooks if a sync or async predicate is falsey.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/unless.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Conditionals">Conditionals</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Boolean | Promise | Function} predicate</code></li>
<li><code>{Array&lt; Function &gt;} hookFuncs</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>predicate</code></td>
<td style="text-align:center"><code>Boolean</code>, <code>Promise</code> or <code>Function</code></td>
<td></td>
<td>Run <code>hookFunc</code> if the <code>predicate</code> is false. If a function, <code>predicate</code> is called with the <code>context</code> as its param. It returns either a boolean or a Promise that evaluates to a boolean.</td>
</tr>
<tr>
<td><code>hookFuncs</code></td>
<td style="text-align:center"><code>Array&lt;</code> <code>Function &gt;</code></td>
<td></td>
<td>Sync or async hook functions to run if <code>true</code>. They may include other conditional hooks.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; isProvider, unless &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  create:</span><br><span class="line">    unless(isProvider(<span class="string">'server'</span>),</span><br><span class="line">      hookA,</span><br><span class="line">      unless(isProvider(<span class="string">'rest'</span>), hook1, hook2, hook3),</span><br><span class="line">      hookB</span><br><span class="line">    )</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Details</strong></p>
<p>Resolve the predicate to a boolean. Run the hooks sequentially if the result is falsey.</p>
<p>The predicate and hook functions will not be called with <code>this</code> set to the service, as is normal for hook functions. Use <code>hook.service</code> instead.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/unless.js" target="_blank" rel="external">unless</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Conditionals">Conditionals</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20unless&body=Comment%20-%20Hooks%20-%20unless" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="validate">validate( validator )</h3>

Validate data using a validation function.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">no</td>
    <td style="text-align:center">create, update, patch</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"><a href="guide.html#validate">validate</a></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/validate.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Services">Services</a>, <a href="#tag-Validation">Validation</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{Function} validator</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>validator</code></td>
<td style="text-align:center"><code>Function</code></td>
<td></td>
<td>Validation function. See Details below..</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; validate &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; promisify &#125; = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// function myCallbackValidator(values, cb) &#123; ... &#125;</span></span><br><span class="line"><span class="keyword">const</span> myValidator = promisify(myCallbackValidator);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  create: validate(myValidator)</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>The validation function may be sync or return a Promise. Sync functions return either an error object like <code>{ fieldName1: &#39;message&#39;, ... }</code> or <code>null</code>. They may also throw with <code>throw new errors.BadRequest({ errors: errors });</code>.</p>
<p>Promise functions should throw on an error or reject with <code>new errors.BadRequest(&#39;Error message&#39;, { errors: { fieldName1: &#39;message&#39;, ... } });</code>. Their <code>.then</code> returns either sanitized values to replace <code>context.data</code>, or <code>null</code>.</p>
<p>The validator‚Äôs parameters are</p>
<ul>
<li><code>{Object} formValues</code></li>
<li><code>{Object} context</code></li>
</ul>
<p>Sync functions return either an error object like <code>{ fieldName1: &#39;message&#39;, ... }</code> or <code>null</code>. <code>Validate</code> will throw on an error object with <code>throw new errors.BadRequest({ errors: errorObject });</code>.</p>
<ul>
<li><code>{Object | null} errors</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>formValues</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The data, e.g. <code>{ name: &#39;John&#39;, ... }</code></td>
</tr>
<tr>
<td><code>context</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The hook context.</td>
</tr>
<tr>
<td><code>errors</code></td>
<td style="text-align:center"><code>Object</code> <code>null</code></td>
<td></td>
<td>An error object like <code>{ fieldName1: &#39;message&#39;, ... }</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>If you have a different signature for the validator then pass a wrapper as the validator e.g. <code>values =&gt; myValidator(..., values, ...)</code>.</p>
</blockquote>
<blockquote>
<p>Wrap your validator in Node‚Äôs <code>util.promisify</code> if it uses a callback.</p>
</blockquote>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/validate.js" target="_blank" rel="external">validate</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: Guide <a href="guide.html#validate">validate</a> and tags <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Services">Services</a>, <a href="#tag-Validation">Validation</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20validate&body=Comment%20-%20Hooks%20-%20validate" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="validateschema">validateSchema( schema, ajv [, options] )</h3>

Validate data using JSON-Schema.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/validate-schema.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Services">Services</a>, <a href="#tag-Validation">Validation</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Object} schema</code></li>
<li><code>{Function | Object} ajv</code></li>
<li><code>{Object} options</code><ul>
<li><code>{Function} [ addNewError ]</code></li>
<li><code>...</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>schema</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The <a href="https://code.tutsplus.com/tutorials/validating-data-with-json-schema-part-1--cms-25343" target="_blank" rel="noopener">JSON-schema.</a></td>
</tr>
<tr>
<td><code>ajv</code></td>
<td style="text-align:center"><code>Function</code> <code>Object</code></td>
<td></td>
<td>The ajv validator. Could be either the Ajv constructor or an instance of it.</td>
</tr>
<tr>
<td><code>options</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>Options for <code>validateSchema</code> and <code>ajv</code>.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>options</code></th>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><code>addNewError</code></td>
<td style="text-align:center"><code>Function</code></td>
<td>see below</td>
<td>Custom error message formatter.</td>
</tr>
<tr>
<td></td>
<td>other</td>
<td style="text-align:center"><code>any</code></td>
<td></td>
<td>Any <code>ajv</code> options. Only effective when the second parameter is the <code>Ajv</code> constructor.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Ajv = <span class="built_in">require</span>(<span class="string">'ajv'</span>);</span><br><span class="line"><span class="keyword">const</span> createSchema = &#123; <span class="comment">/* JSON-Schema */</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.before(&#123;</span><br><span class="line">  create: validateSchema(createSchema, Ajv)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Ajv = <span class="built_in">require</span>(<span class="string">'ajv'</span>);</span><br><span class="line"><span class="keyword">const</span> ajv = <span class="keyword">new</span> Ajv(&#123; <span class="attr">allErrors</span>: <span class="literal">true</span>, <span class="attr">$data</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line">ajv.addFormat(<span class="string">'allNumbers'</span>, <span class="string">'^\d+$'</span>);</span><br><span class="line"><span class="keyword">const</span> createSchema = &#123; <span class="comment">/* JSON-Schema */</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.before(&#123;</span><br><span class="line">  create: validateSchema(createSchema, ajv)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>There are some good <a href="https://code.tutsplus.com/tutorials/validating-data-with-json-schema-part-1--cms-25343" target="_blank" rel="noopener">tutorials</a> on using JSON-Schema with <a href="https://github.com/epoberezkin/ajv" target="_blank" rel="noopener">Ajv</a>.</p>
<p>If you need to customize <code>Ajv</code> with new keywords, formats or schemas, then instead of passing the <code>Ajv</code> constructor, you may pass in an instance of <code>Ajv</code> as the second parameter. In this case you need to pass <code>Ajv</code> options to the <code>Ajv</code> instance when <code>new</code>ing, rather than passing them in the third parameter of <code>validateSchema</code>. See the examples.</p>
</li>
<li><p><strong>options.addNewError</strong></p>
<p>The hook will throw if the data does not match the JSON-Schema. <code>error.errors</code> will, by default, contain an array of error messages. You may change this with a custom formatting function. Its a reducing function which works similarly to <code>Array.reduce()</code>. Its parameters are</p>
<ul>
<li><code>{any} currentFormattedMessages</code></li>
<li><code>{Object} ajvErrorObject</code></li>
<li><code>{Number} itemsLen</code></li>
<li><code>{Number} index</code></li>
</ul>
<p>It returns</p>
<ul>
<li><code>{any} newFormattedMessages</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>currentFormattedMessages</code></td>
<td style="text-align:center"><code>any</code></td>
<td>initially <code>null</code></td>
<td>Formatted messages so far. Initially null.</td>
</tr>
<tr>
<td><code>ajvErrorObject</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td><a href="https://github.com/epoberezkin/ajv#error-objects" target="_blank" rel="noopener">ajv error object</a></td>
</tr>
<tr>
<td><code>itemsLen</code></td>
<td style="text-align:center"><code>Number</code></td>
<td></td>
<td>How many data items there are. 1-based.</td>
</tr>
<tr>
<td><code>item</code></td>
<td style="text-align:center"><code>Number</code></td>
<td></td>
<td>Which item this is. 0-based.</td>
</tr>
<tr>
<td><code>newFormattedMessages</code></td>
<td style="text-align:center"><code>any</code></td>
<td></td>
<td>The function returns the updated formatted messages.</td>
</tr>
</tbody>
</table>
<p>  <code>error.errors</code> will, by default, contain an array of error messages. By default the message will look like<br>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[ <span class="string">"'in row 1 of 3, first' should match format \"startWithJo\""</span>,</span><br><span class="line">  <span class="string">"in row 1 of 3, should have required property 'last'"</span>,</span><br><span class="line">  <span class="string">"'in row 2 of 3, first' should match format \"startWithJo\""</span>,</span><br><span class="line">  <span class="string">"in row 3 of 3, should have required property 'last'"</span> ]</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>You could, for example, return <code>{ name1: message, name2: message }</code> which might be more suitable for a UI.</p>
</blockquote>
<ul>
<li><p><strong>Internationalization of Messages</strong></p>
<p>You can consider using <a href="https://github.com/epoberezkin/ajv-i18n" target="_blank" rel="noopener">ajv-i18n</a>, together with ajv‚Äôs <code>messages</code> option, to internationalize your error messages.</p>
<p>You can also consider copying <code>addNewErrorDflt</code>, the default error message formatter, modifying it for your needs, and using that as <code>newFormattedMessages</code>.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/validate-schema.js" target="_blank" rel="external">validateSchema</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Data%20and%20Results">Data and Results</a>, <a href="#tag-Services">Services</a>, <a href="#tag-Validation">Validation</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20validateSchema&body=Comment%20-%20Hooks%20-%20validateSchema" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="when">when( predicate, ‚Ä¶hookFuncs )</h3>

<p>An alias for <a href="#iff">iff</a>.</p>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/iff.js" target="_blank" rel="external">when</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Conditionals">Conditionals</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20when&body=Comment%20-%20Hooks%20-%20when" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h2 id="Utilities"><a href="#Utilities" class="headerlink" title="Utilities"></a>Utilities</h2><!--=============================================================================================-->
<h3 id="callingparams">callingParams(options)(context)</h3>

Build <code>params</code> for a service call. (Utility function.)<br>
    <table>
    <thead>
    <tr>
      <th style="text-align:center">guide</th>
      <th style="text-align:center">details</th>
      <th style="text-align:center">tags</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/calling-params.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Calling%20services">Calling services</a>, <a href="#tag-Coding">Coding</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Object} options</code></li>
<li><code>{Object} context</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>options</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>How to construct params for service call.</td>
</tr>
<tr>
<td><code>context</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The <code>context</code> of the hook which will make the service call. </td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>options</code></th>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><code>query</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The <code>params.query</code> for the calling params.</td>
</tr>
<tr>
<td></td>
<td><code>propNames</code></td>
<td style="text-align:center"><code>Array&lt; String &gt;</code></td>
<td><code>[]</code></td>
<td>The names of the props in <code>context.params</code> to include in the new params.</td>
</tr>
<tr>
<td></td>
<td><code>newProps</code></td>
<td style="text-align:center"><code>Object</code></td>
<td><code>{}</code></td>
<td>Additional props to add to the new params.</td>
</tr>
<tr>
<td></td>
<td><code>hooksToDisable</code></td>
<td style="text-align:center"><code>Array&lt; String &gt;</code></td>
<td><code>[]</code></td>
<td>The names of hooks to disable during the service call. <code>populate</code>, <code>fastJoin</code>, <code>softDelete</code> and <code>stashBefore</code> are supported.</td>
</tr>
<tr>
<td></td>
<td><code>ignoreDefaults</code></td>
<td style="text-align:center"><code>Boolean</code></td>
<td></td>
<td>Ignore the defaults <code>propNames</code> and <code>newProps</code>.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Returns</strong></p>
<ul>
<li><code>{Object} newParams</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Name</th>
<th style="text-align:center">Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>newParams</code></td>
<td style="text-align:center"><code>Object</code></td>
<td>The params for the service call.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; callingParams, callingParamsDefaults &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"><span class="comment">// Authentication props to always copy. Suitable for feathers-authentication-management.</span></span><br><span class="line">callingParamsDefaults([<span class="string">'provider'</span>, <span class="string">'authenticated'</span>, <span class="string">'user'</span>, <span class="string">'isVerified'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">myCustomHook</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> service.find(callingParams(&#123;</span><br><span class="line">    query: &#123; &#123; <span class="attr">id</span>: &#123; <span class="attr">$in</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] &#125; &#125; &#125;,</span><br><span class="line">    propNames: [<span class="string">'customProp'</span>],</span><br><span class="line">    newProps: &#123; <span class="attr">mongoose</span>: ... &#125;,</span><br><span class="line">    hooksToDisable: <span class="string">'populate'</span></span><br><span class="line">  &#125;), context);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>When calling another service within a hook, <a href="https://auk.docs.feathersjs.com/guides/step-by-step/basic-feathers/writing-hooks.html#calling-a-service" target="_blank" rel="noopener">consideration must be given</a> to what the <code>params</code> should be for the called service. For example, should the called service see that a client is making the call, or the server? What authentication and authorization information should be provided? You can use this convenience function to help create that <code>params</code>.</p>
<p>The properties <code>provider</code>, <code>authenticated</code> and <code>user</code> are the standard authentication properties used by Feathers. They are copied automatically.</p>
<p>These defaults and others can be changed app-wide by calling the <code>callingParamsDefaults</code> utility.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/calling-params.js" target="_blank" rel="external">callingParams</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Calling%20services">Calling services</a>, <a href="#tag-Coding">Coding</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20callingParams&body=Comment%20-%20Hooks%20-%20callingParams" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="callingparamsdefaults">callingParamsDefaults(propNames, newProps)</h3>

Set defaults for building <code>params</code> for service calls with <code>callingParams</code>. (Utility function.)<br>
    <table>
    <thead>
    <tr>
      <th style="text-align:center">guide</th>
      <th style="text-align:center">details</th>
      <th style="text-align:center">tags</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/calling-params.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Calling%20services">Calling services</a>, <a href="#tag-Coding">Coding</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Array&lt; String &gt;} propNames</code></li>
<li><code>{Object} newProps</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>propNames</code></td>
<td style="text-align:center"><code>Array&lt; String &gt;</code></td>
<td></td>
<td>The names of the props in <code>context.params</code> to automatically include in the new params.</td>
</tr>
<tr>
<td><code>newProps</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>Additional props to add to the new params. </td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; callingParams, callingParamsDefaults &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"><span class="comment">// Authentication props to always copy. Suitable for feathers-authentication-management.</span></span><br><span class="line"><span class="comment">// Only hooks will be calling `callingParams`. Set a flag so other hooks recognize such a call.</span></span><br><span class="line">callingParamsDefaults([<span class="string">'provider'</span>, <span class="string">'authenticated'</span>, <span class="string">'user'</span>, <span class="string">'isVerified'</span>], &#123; <span class="attr">_calledByHook</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">myCustomHook</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> service.find(callingParams(&#123;</span><br><span class="line">    query: &#123; &#123; <span class="attr">id</span>: &#123; <span class="attr">$in</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] &#125; &#125; &#125;,</span><br><span class="line">    propNames: [<span class="string">'customProp'</span>],</span><br><span class="line">    newProps: &#123; <span class="attr">mongoose</span>: ... &#125;,</span><br><span class="line">    hooksToDisable: <span class="string">'populate'</span></span><br><span class="line">  &#125;), context);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>When calling another service within a hook, <a href="https://auk.docs.feathersjs.com/guides/step-by-step/basic-feathers/writing-hooks.html#calling-a-service" target="_blank" rel="noopener">consideration must be given</a> to what the <code>params</code> should be for the called service. For example, should the called service see that a client is making the call, or the server? What authentication and authorization information should be provided? You can use this convenience function to help create that <code>params</code>.</p>
<p>The properties <code>provider</code>, <code>authenticated</code> and <code>user</code> are the standard authentication properties used by Feathers. They are copied automatically.</p>
<p>These defaults and others can be changed app-wide by calling the <code>callingParamsDefaults</code> utility.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/calling-params.js" target="_blank" rel="external">callingParamsDefaults</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Calling%20services">Calling services</a>, <a href="#tag-Coding">Coding</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20callingParamsDefaults&body=Comment%20-%20Hooks%20-%20callingParamsDefaults" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="checkcontext">checkContext( context [, type ] [, methods ] [, label ] )</h3>

Restrict a hook to run for certain methods and method types. (Utility function.)<br>
    <table>
    <thead>
    <tr>
      <th style="text-align:center">guide</th>
      <th style="text-align:center">details</th>
      <th style="text-align:center">tags</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/check-context.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Coding">Coding</a>, <a href="#tag-Services">Services</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Object} context</code></li>
<li><code>{String} [ type ]</code></li>
<li><code>{Array&lt; String &gt;} [ methods ]</code></li>
<li><code>{String} [ label ]</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>context</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The hook context.</td>
</tr>
<tr>
<td><code>type</code></td>
<td style="text-align:center"><code>String</code></td>
<td>all types</td>
<td>The service type allowed - before, after.</td>
</tr>
<tr>
<td><code>methods</code></td>
<td style="text-align:center"><code>Array&lt; String &gt;</code></td>
<td>all methods</td>
<td>The service methods allowed - find, get, update, patch, remove.</td>
</tr>
<tr>
<td><code>label</code></td>
<td style="text-align:center"><code>String</code></td>
<td><code>&#39;anonymous&#39;</code></td>
<td>Name of hook to use with <code>throw</code>.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; checkContext &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myHook</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  checkContext(context, <span class="string">'after'</span>, [<span class="string">'create'</span>, <span class="string">'remove'</span>]);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">    create: [ myHook ] <span class="comment">// throws</span></span><br><span class="line">&#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkContext(hook, 'before', ['update', 'patch'], 'hookName');</span></span><br><span class="line"><span class="comment">// checkContext(hook, null, ['update', 'patch']);</span></span><br><span class="line"><span class="comment">// checkContext(hook, 'before', null, 'hookName');</span></span><br><span class="line"><span class="comment">// checkContext(hook, 'before');</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>Its important to ensure the hook is being used as intended. <code>checkContext</code> let‚Äôs you restrict the hook to a hook type and a set of service methods.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/check-context.js" target="_blank" rel="external">checkContext</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Coding">Coding</a>, <a href="#tag-Services">Services</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20checkContext&body=Comment%20-%20Hooks%20-%20checkContext" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="combine">combine( ‚Ä¶hookFuncs )</h3>

Sequentially execute multiple sync or async hooks.<br>
  <table>
  <thead>
  <tr>
  <th style="text-align:center">before</th>
    <th style="text-align:center">after</th>
    <th style="text-align:center">methods</th>
    <th style="text-align:center">multi recs</th>
    <th style="text-align:center">guide</th>
    <th style="text-align:center">details</th>
    <th style="text-align:center">tags</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">yes</td>
    <td style="text-align:center">all</td>
    <td style="text-align:center">n/a</td>
    <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/combine.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Coding">Coding</a>, <a href="#tag-Conditionals">Conditionals</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Array&lt; Function &gt;} hookFuncs</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hookFuncs</code></td>
<td style="text-align:center"><code>Array&lt;Function &gt;</code></td>
<td></td>
<td>Hooks, used the same way as when you register them.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; combine, createdAt, updatedAt &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">myCustomHook</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> newContext = <span class="keyword">await</span> combine(setNow(<span class="string">'createdAt'</span>), setNow(<span class="string">'updatedAt'</span>)).call(<span class="keyword">this</span>, context);</span><br><span class="line">  <span class="keyword">return</span> newContext;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p><code>combine</code> has the signature of a hook, but is primarily intended to be used within your custom hooks, not when registering hooks.</p>
<p>The following is a better technique to use when registering hooks.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> workflow = [createdAt(), updatedAt(), ...];</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  update: [...workflow],</span><br><span class="line">  patch: [...workflow],</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/combine.js" target="_blank" rel="external">combine</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Coding">Coding</a>, <a href="#tag-Conditionals">Conditionals</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20combine&body=Comment%20-%20Hooks%20-%20combine" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="deletebydot">deleteByDot( obj, path )</h3>

Deletes a property from an object using dot notation, e.g. <code>address.city</code>. (Utility function.)<br>
    <table>
    <thead>
    <tr>
      <th style="text-align:center">guide</th>
      <th style="text-align:center">details</th>
      <th style="text-align:center">tags</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/delete-by-dot.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Coding">Coding</a>, <a href="#tag-Dot%20notation">Dot notation</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Object} obj</code></li>
<li><code>{String} path</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>obj</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The object.</td>
</tr>
<tr>
<td><code>path</code></td>
<td style="text-align:center"><code>String</code></td>
<td></td>
<td>The path to the property, e.g. <code>address.city</code>. </td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; deleteByDot &#125; <span class="keyword">from</span> <span class="string">'feathers-hooks-common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> discardPasscode = <span class="function"><span class="params">()</span> =&gt;</span> <span class="function"><span class="params">context</span> =&gt;</span> &#123;</span><br><span class="line">  deleteByDot(context.data, <span class="string">'security.passcode'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">   find: discardPasscode()</span><br><span class="line"> &#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>You can use <code>phones.home.0.main</code> to handle arrays.</p>
<p>If you delete an array element, e.g. <code>phones.home.1</code>, that element will be removed from the array.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/delete-by-dot.js" target="_blank" rel="external">deleteByDot</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Coding">Coding</a>, <a href="#tag-Dot%20notation">Dot notation</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20deleteByDot&body=Comment%20-%20Hooks%20-%20deleteByDot" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="existsbydot">existsByDot( obj, path )</h3>

Check if a property exists in an object by using dot notation, e.g. <code>address.city</code>. (Utility function.)<br>
    <table>
    <thead>
    <tr>
      <th style="text-align:center">guide</th>
      <th style="text-align:center">details</th>
      <th style="text-align:center">tags</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/exists-by-dot.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Coding">Coding</a>, <a href="#tag-Dot%20notation">Dot notation</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Object} obj</code></li>
<li><code>{String} path</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>obj</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The object.</td>
</tr>
<tr>
<td><code>path</code></td>
<td style="text-align:center"><code>String</code></td>
<td></td>
<td>The path to the property, e.g. <code>address.city</code>.</td>
</tr>
</tbody>
</table>

  <ul><li>
    <strong>Returns</strong>
    <ul><li>
      <code>{Boolean} result</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>result</code></td>
    <td style="text-align:center"><code>Boolean</code></td>
    <td style="text-align:left">If a property exists at <code>path</code>.</td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; discard, existsByDot, iff &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> discardBadge = <span class="function"><span class="params">()</span> =&gt;</span> <span class="function"><span class="params">context</span> =&gt;</span> &#123;</span><br><span class="line">  iff(</span><br><span class="line">    !existsByDot(context.data, <span class="string">'security.passcode'</span>),</span><br><span class="line">    discard(<span class="string">'security.badge'</span>)</span><br><span class="line">  )(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  find: discardBadge()</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>You can use <code>phones.home.0.main</code> to handle arrays.<br>Properties with a value of <code>undefined</code> are considered to exist.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/exists-by-dot.js" target="_blank" rel="external">existsByDot</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Coding">Coding</a>, <a href="#tag-Dot%20notation">Dot notation</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20existsByDot&body=Comment%20-%20Hooks%20-%20existsByDot" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="getbydot">getByDot( obj, path )</h3>

Return a property value from an object using dot notation, e.g. <code>address.city</code>. (Utility function.)<br>
    <table>
    <thead>
    <tr>
      <th style="text-align:center">guide</th>
      <th style="text-align:center">details</th>
      <th style="text-align:center">tags</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/get-by-dot.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Coding">Coding</a>, <a href="#tag-Dot%20notation">Dot notation</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Object} obj</code></li>
<li><code>{String} path</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>obj</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The object.</td>
</tr>
<tr>
<td><code>path</code></td>
<td style="text-align:center"><code>String</code></td>
<td></td>
<td>The path to the property, e.g. <code>address.city</code>.</td>
</tr>
</tbody>
</table>

  <ul><li>
    <strong>Returns</strong>
    <ul><li>
      <code>{any} result</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>result</code></td>
    <td style="text-align:center"><code>any</code></td>
    <td style="text-align:left">The property value.</td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; getByDot, setByDot &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setHomeCity = <span class="function"><span class="params">()</span> =&gt;</span> <span class="function"><span class="params">context</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> city = getByDot(context.data, <span class="string">'person.address.city'</span>);</span><br><span class="line">  setByDot(context, <span class="string">'data.person.home.city'</span>, city);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  create: setHomeCity()</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p><code>getByDot</code> does not differentiate between non-existent paths and a value of <code>undefined</code>.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/get-by-dot.js" target="_blank" rel="external">getByDot</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Coding">Coding</a>, <a href="#tag-Dot%20notation">Dot notation</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20getByDot&body=Comment%20-%20Hooks%20-%20getByDot" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="setbydot">setByDot( obj, path, value )</h3>

Set a property value in an object using dot notation, e.g. <code>address.city</code>. (Utility function.)<br>
    <table>
    <thead>
    <tr>
      <th style="text-align:center">guide</th>
      <th style="text-align:center">details</th>
      <th style="text-align:center">tags</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/set-by-dot.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Coding">Coding</a>, <a href="#tag-Dot%20notation">Dot notation</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Object} obj</code></li>
<li><code>{String} path</code></li>
<li><code>{any} value</code> </li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>obj</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The object.</td>
</tr>
<tr>
<td><code>path</code></td>
<td style="text-align:center"><code>String</code></td>
<td></td>
<td>The path to the property, e.g. <code>address.city</code>.</td>
</tr>
<tr>
<td><code>value</code></td>
<td style="text-align:center"><code>any</code></td>
<td></td>
<td>The value to set the property to.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; getByDot, setByDot &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setHomeCity = <span class="function"><span class="params">()</span> =&gt;</span> <span class="function"><span class="params">context</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> city = getByDot(context.data, <span class="string">'person.address.city'</span>);</span><br><span class="line">  setByDot(context, <span class="string">'data.person.home.city'</span>, city);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  create: setHomeCity()</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/common/set-by-dot.js" target="_blank" rel="external">setByDot</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Coding">Coding</a>, <a href="#tag-Dot%20notation">Dot notation</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20setByDot&body=Comment%20-%20Hooks%20-%20setByDot" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="getitems">getItems( context )</h3>

Get the records in <code>context.data</code> or <code>context.result[.data]</code>. (Utility function.)<br>
    <table>
    <thead>
    <tr>
      <th style="text-align:center">guide</th>
      <th style="text-align:center">details</th>
      <th style="text-align:center">tags</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/get-items.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Coding">Coding</a>, <a href="#tag-Data%20and%20Results">Data and Results</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Object} context</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>context</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The hook context.</td>
</tr>
</tbody>
</table>

  <ul><li>
    <strong>Returns</strong>
    <ul><li>
      <code>{Array< Object > | Object | undefined} records</code>
    </li></ul>
  </li></ul>
  
  <table>
  <thead>
  <tr>
    <th style="text-align:left">Name</th>
    <th style="text-align:center">Type</th>
    <th style="text-align:left">Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="text-align:left"><code>records</code></td>
    <td style="text-align:center"><code>Array< Object > | Object | undefined</code></td>
    <td style="text-align:left">The records.</td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; getItems, replaceItems &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> insertCode = <span class="function"><span class="params">code</span> =&gt;</span> context &#123;</span><br><span class="line">  <span class="keyword">const</span> items = getItems(context);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(items)) &#123;</span><br><span class="line">    items.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123; item.code = code; &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    items.code = code;</span><br><span class="line">  &#125;</span><br><span class="line">  replaceItems(context, items);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  create: insertCode(<span class="string">'a'</span>)</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p><code>getItems</code> gets the records from the hook context: <code>context.data</code> (before hook) or <code>context.result[.data]</code> (after hook).</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/get-items.js" target="_blank" rel="external">getItems</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Coding">Coding</a>, <a href="#tag-Data%20and%20Results">Data and Results</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20getItems&body=Comment%20-%20Hooks%20-%20getItems" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="replaceitems">replaceItems( context, records )</h3>

Replace the records in <code>context.data</code> or <code>context.result[.data]</code>. (Utility function.)<br>
    <table>
    <thead>
    <tr>
      <th style="text-align:center">guide</th>
      <th style="text-align:center">details</th>
      <th style="text-align:center">tags</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/replace-items.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Coding">Coding</a>, <a href="#tag-Data%20and%20Results">Data and Results</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>{Object} context</code></li>
<li><code>{Array&lt; Object &gt; | Object} records</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>context</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The hook context.</td>
</tr>
<tr>
<td><code>records</code></td>
<td style="text-align:center"><code>Array&lt; Object &gt;</code> <code>Object</code></td>
<td></td>
<td>The new records.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; getItems, replaceItems &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> insertCode = <span class="function"><span class="params">code</span> =&gt;</span> context &#123;</span><br><span class="line">  <span class="keyword">const</span> items = getItems(context);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(items)) &#123;</span><br><span class="line">    items.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123; item.code = code; &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    items.code = code;</span><br><span class="line">  &#125;</span><br><span class="line">  replaceItems(context, items);</span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">  create: insertCode(<span class="string">'a'</span>)</span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p><code>replaceItems</code> replaces the records in the hook context: <code>context.data</code> (before hook) or <code>context.result[.data]</code> (after hook).</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/replace-items.js" target="_blank" rel="external">replaceItems</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Coding">Coding</a>, <a href="#tag-Data%20and%20Results">Data and Results</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20replaceItems&body=Comment%20-%20Hooks%20-%20replaceItems" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="makecallingparams">makeCallingParams( context, query, include, inject )</h3>

Build <code>context.params</code> for service calls. (Utility function.)<br>
    <table>
    <thead>
    <tr>
      <th style="text-align:center">guide</th>
      <th style="text-align:center">details</th>
      <th style="text-align:center">tags</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/calling-params.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Calling%20services">Calling services</a>, <a href="#tag-Coding">Coding</a></td>
  </tr>
  </tbody>
  </table>
<p class="tip">You should prefer using the <code>callingParams</code> utility to <code>makeCallingParams</code>.</p>

<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Object} context</code></li>
<li><code>{Object} [ query ]</code></li>
<li><code>{Array&lt; String &gt; | String} [ include ]</code></li>
<li><code>{Object} [ inject ]</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>context</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The existing hook context.</td>
</tr>
<tr>
<td><code>query</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The <code>context.params.query</code> for the new context.</td>
</tr>
<tr>
<td><code>include</code></td>
<td style="text-align:center"><code>Array&lt; String &gt;</code></td>
<td></td>
<td>The names of the props in <code>context</code> to include in the new context.</td>
</tr>
<tr>
<td><code>inject</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>Additional props to add to the new context.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Returns</strong></p>
<ul>
<li><code>{Object} newContext</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Variable</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>newContext</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The new context created.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; makeCallingParams &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">myCustomHook</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> service.find(makeCallingParams(</span><br><span class="line">    context, &#123; <span class="attr">id</span>: &#123; <span class="attr">$in</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] &#125; &#125;, <span class="string">'user'</span>,</span><br><span class="line">    &#123; <span class="attr">_populate</span>: <span class="literal">false</span>, <span class="attr">mongoose</span>: ... &#125;</span><br><span class="line">  ));</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>When calling another service within a hook, <a href="https://auk.feathersjs.com/guides/step-by-step/basic-feathers/writing-hooks.html#calling-a-service" target="_blank" rel="noopener">consideration must be given</a> to what the <code>context.params</code> should be for the called service. For example, should the called service see that a client is making the call, or the server? What authentication and authorization information should be provided? You can use this convenience function to help create that <code>context.params</code>.</p>
<p>The value <code>context.params._populate: &#39;skip&#39;</code> is automatically added to skip any <code>fastJoin</code> or <code>populate</code> hooks registered on the called service. Set it to <code>false</code>, like in the example above, to make those hooks run.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/calling-params.js" target="_blank" rel="external">makeCallingParams</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Calling%20services">Calling services</a>, <a href="#tag-Coding">Coding</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20makeCallingParams&body=Comment%20-%20Hooks%20-%20makeCallingParams" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="paramsforserver">paramsForServer( params [, ‚Ä¶ whitelist] )</h3>

Pass an explicit <code>context.params</code> from client to server. Client-side. (Utility function.)<br>
    <table>
    <thead>
    <tr>
      <th style="text-align:center">guide</th>
      <th style="text-align:center">details</th>
      <th style="text-align:center">tags</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/params-for-server.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Calling%20services">Calling services</a>, <a href="#tag-Client%2Fserver">Client/server</a>, <a href="#tag-Coding">Coding</a>, <a href="#tag-Transport">Transport</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Object} params</code></li>
<li><code>{Array&lt; String &gt;} [ whitelist ]</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>params</code></td>
<td style="text-align:center"><code>Object</code></td>
<td></td>
<td>The <code>context.params</code> to use for the service call, including any query object.</td>
</tr>
<tr>
<td><code>whitelist</code></td>
<td style="text-align:center">dot notation</td>
<td>all props in <code>context.params</code></td>
<td>Names of the props in <code>context.params</code> to transfer to the server. This is a security feature. All props are transferred if no <code>whitelist</code> is provided.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// client</span></span><br><span class="line"><span class="keyword">const</span> &#123; paramsForServer &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line">service.update(id, data, paramsForServer(&#123;</span><br><span class="line">  query: &#123; <span class="attr">dept</span>: <span class="string">'a'</span> &#125;, <span class="attr">populate</span>: <span class="string">'po-1'</span>, <span class="attr">serialize</span>: <span class="string">'po-mgr'</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// server</span></span><br><span class="line"><span class="keyword">const</span> &#123; paramsFromClient &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">    all: [</span><br><span class="line">      paramsFromClient(<span class="string">'populate'</span>, <span class="string">'serialize'</span>, <span class="string">'otherProp'</span>),</span><br><span class="line">      myHook</span><br><span class="line">    ]</span><br><span class="line">&#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// myHook's `context.params` will now be</span></span><br><span class="line"><span class="comment">// &#123; query: &#123; dept: 'a' &#125;, populate: 'po-1', serialize: 'po-mgr' &#125; &#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Details</strong></p>
<p>By default, only the <code>context.params.query</code> object is transferred from a Feathers client to the server, for security among other reasons. However you can explicitly transfer other <code>context.params</code> props with the client utility function <code>paramsForServer</code> in conjunction with the <code>paramsFromClient</code> hook on the server.</p>
<p>This technique also works for service calls made on the server.</p>
<p class="tip">The data is transfered using <code>context.params.query.$client</code>. If that field already exists, it must be an Object.</p>

</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/params-for-server.js" target="_blank" rel="external">paramsForServer</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Calling%20services">Calling services</a>, <a href="#tag-Client%2Fserver">Client/server</a>, <a href="#tag-Coding">Coding</a>, <a href="#tag-Transport">Transport</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20paramsForServer&body=Comment%20-%20Hooks%20-%20paramsForServer" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<h3 id="runhook">runHook( [ hookContext ] )( hookFunc )</h3>

Let's you call a hook right after the service call. (Utility function.)<br>
    <table>
    <thead>
    <tr>
      <th style="text-align:center">guide</th>
      <th style="text-align:center">details</th>
      <th style="text-align:center">tags</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td style="text-align:center"></td>
    <td style="text-align:center"><a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/run-hook.js" target="_blank" rel="external">source</a></td>
    <td style="text-align:center"><a href="#tag-Coding">Coding</a>, <a href="#tag-Services">Services</a></td>
  </tr>
  </tbody>
  </table>
<ul>
<li><strong>Arguments</strong><ul>
<li><code>{Object} [ hookContext ]</code></li>
<li><code>{Function} hookFunc</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hookContext</code></td>
<td style="text-align:center"><code>Object</code></td>
<td><code>{}</code></td>
<td>The <code>context</code> for <code>hookFunc</code>.</td>
</tr>
<tr>
<td><code>hookFunc</code></td>
<td style="text-align:center"><code>Function</code></td>
<td></td>
<td>The hook to run.</td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; keep, runHook &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line">user.get(...)</span><br><span class="line">  .then( runHook()(keep(<span class="string">'name'</span>, <span class="string">'address.state'</span>)) )</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> ...); <span class="comment">// [&#123; name: 'Marshall', address: &#123; state: 'UT' &#125;&#125;]</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> data = <span class="keyword">await</span> user.get(...);</span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> runHook()(data)(keep(<span class="string">'name'</span>, <span class="string">'address.state'</span>));</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; fastJoin, runHook &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"><span class="keyword">const</span> runHookFinds = runHook(&#123; <span class="attr">app</span>: app, <span class="attr">method</span>: <span class="string">'find'</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> paymentsRecords= [</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">101</span>, <span class="attr">amount</span>: <span class="number">100</span>, <span class="attr">patientId</span>: <span class="number">1</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">102</span>, <span class="attr">amount</span>: <span class="number">105</span>, <span class="attr">patientId</span>: <span class="number">1</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">103</span>, <span class="attr">amount</span>: <span class="number">110</span>, <span class="attr">patientId</span>: <span class="number">1</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">104</span>, <span class="attr">amount</span>: <span class="number">115</span>, <span class="attr">patientId</span>: <span class="number">2</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">105</span>, <span class="attr">amount</span>: <span class="number">120</span>, <span class="attr">patientId</span>: <span class="number">3</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">106</span>, <span class="attr">amount</span>: <span class="number">125</span>, <span class="attr">patientId</span>: <span class="number">3</span> &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="keyword">await</span> payments.create(paymentsRecords);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> patientsRecords = [</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'John'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">'Marshall'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">'David'</span> &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="keyword">await</span> patients.create(patientsRecords);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> paymentResolvers = &#123;</span><br><span class="line">  joins: &#123;</span><br><span class="line">    patient: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">async</span> payment =&gt; &#123;</span><br><span class="line">      payment.patient = (<span class="keyword">await</span> patients.find(&#123; <span class="attr">query</span>: &#123;</span><br><span class="line">        id: payment.patientId</span><br><span class="line">      &#125; &#125;))[<span class="number">0</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">await</span> payments.find()</span><br><span class="line">  .then( runHookFinds(fastJoin(paymentResolvers)) )</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data));</span><br><span class="line">  </span><br><span class="line"><span class="comment">// log</span></span><br><span class="line">[ &#123; <span class="attr">_id</span>: <span class="number">101</span>, <span class="attr">amount</span>: <span class="number">100</span>, <span class="attr">patientId</span>: <span class="number">1</span>, <span class="attr">patient</span>: &#123; <span class="attr">_id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'John'</span> &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">102</span>, <span class="attr">amount</span>: <span class="number">105</span>, <span class="attr">patientId</span>: <span class="number">1</span>, <span class="attr">patient</span>: &#123; <span class="attr">_id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'John'</span> &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">103</span>, <span class="attr">amount</span>: <span class="number">110</span>, <span class="attr">patientId</span>: <span class="number">1</span>, <span class="attr">patient</span>: &#123; <span class="attr">_id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'John'</span> &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">104</span>, <span class="attr">amount</span>: <span class="number">115</span>, <span class="attr">patientId</span>: <span class="number">2</span>, <span class="attr">patient</span>: &#123; <span class="attr">_id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">'Marshall'</span> &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">105</span>, <span class="attr">amount</span>: <span class="number">120</span>, <span class="attr">patientId</span>: <span class="number">3</span>, <span class="attr">patient</span>: &#123; <span class="attr">_id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">'David'</span> &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">_id</span>: <span class="number">106</span>, <span class="attr">amount</span>: <span class="number">125</span>, <span class="attr">patientId</span>: <span class="number">3</span>, <span class="attr">patient</span>: &#123; <span class="attr">_id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">'David'</span> &#125; &#125; ]</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong> Details</strong></p>
<p>Hooks are normally registered for a service, e.g. in <code>project/src/services</code> <code>/posts/posts.hooks.js</code>. This is nice and simple when, for example,  all the <code>find</code> hooks have to run for every <code>find</code> call.</p>
<p>The <a href="#tag-Conditionals">conditional hooks</a> can be used when hooks have to be conditionally run based on the current environment. For example, we can discard the <code>password</code> field when the call is made by a client.</p>
<p>However things are not always so straightforward. There can be that one call for which we want to join specific records. We could add a conditional hook that runs just for that one call, however we may soon find ourselves with a second and a third special case.</p>
<p><code>runHook</code> is designed for such cases. Instead of having to register a conditioned hook, it allows us to run the hook in a <code>.then()</code> right after the service call.</p>
</li>
</ul>

  <ul>
    <li><strong>See source</strong>: <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/lib/services/run-hook.js" target="_blank" rel="external">runHook</a></li>
  </ul>
  <ul>
   <li><strong>See also</strong>: <a href="#tag-Coding">Coding</a>, <a href="#tag-Services">Services</a></li>
  </ul>
  <ul>
    <li><strong>Is anything wrong, unclear, missing?</strong>: <a href="https://github.com/feathers-plus/docs/issues/new?title=Comment%20-%20Hooks%20-%20runHook&body=Comment%20-%20Hooks%20-%20runHook" target="_blank" _blank" rel="noopener">Leave a comment.</a></li>
  </ul>
<!--=============================================================================================-->
<!--=============================================================================================-->
<!--=============================================================================================-->
<h3 id="???">???</h3>

?????????? hook ??? not defined.
<ul>
<li><p><strong>Arguments</strong></p>
<ul>
<li><code>???</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Argument</th>
<th style="text-align:center">Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>transports</code></td>
<td style="text-align:center"></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; ??? &#125; = <span class="built_in">require</span>(<span class="string">'feathers-hooks-common'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">before</span>: &#123;</span><br><span class="line">    </span><br><span class="line">&#125; &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><strong>Details</strong></li>
</ul>
?????????? hook ??? not defined.
<!--=============================================================================================-->
<!--=============================================================================================-->
<h2 id="F-A-Q"><a href="#F-A-Q" class="headerlink" title="F.A.Q."></a>F.A.Q.</h2><!--=============================================================================================-->
<h3 id="coerce">Coerce data types</h3>

<p> A common need is converting fields coming in from query params.  These fields are provided as string values by default and you may need them as numbers, booleans, etc.</p>
<p> The <a href="#validateSchema"><code>validateSchema</code></a> does a wide selection of <a href="https://github.com/epoberezkin/ajv/blob/master/COERCION.md" target="_blank" rel="noopener">type coercions</a>, as well as checking for missing and unexpected fields.</p>
<!--=============================================================================================-->
<h2 id="New-Features-in-Buzzard"><a href="#New-Features-in-Buzzard" class="headerlink" title="New Features in Buzzard"></a>New Features in Buzzard</h2><blockquote>
<p>Features added since the initial Buzzard release are listed in the <a href="#whats-new">What‚Äôs New section</a>.</p>
</blockquote>
<p>These features are new in the Buzzard version.</p>
<ul>
<li><p>The docs <a href="https://feathers-plus.github.io/v1/feathers-hooks-common" target="_blank" rel="noopener">have been rewritten.</a></p>
</li>
<li><p>You can now find hooks using <a href="#Find-Hooks-using-Tags">tags.</a> Each Feathers hook and utility function is listed under all the tags relevant to it.</p>
</li>
<li><p>The new <code>fastJoin</code> hook is a much faster, more flexible alternative to <code>populate</code>.</p>
<ul>
<li>It makes only about 10% of the service calls, i.e. it makes <em>2</em> calls when <code>populate</code> would make <em>20</em>.</li>
<li>It operates on record formats which <code>populate</code> can‚Äôt process.</li>
<li>It provides any Feathers service with GraphQL-light capabilities. (The new <code>@feathers-plus/graphql</code> service adapter provides similar performance with full GraphQL compatibility.) </li>
</ul>
</li>
<li><p>The new <code>runHook</code> utility may help simplify your registered hooks. It let‚Äôs you call a hook with <code>service.get(...).then(runHook()(populate(...)));</code>.</p>
</li>
<li><p>Other new hooks and utility functions.</p>
<ul>
<li><code>alterItems</code> - Flexibly mutate data and results. Powerful.</li>
<li><code>cache</code> - Persistent, least-recently-used record cache for services.</li>
<li><code>disablePagination</code> - Disables pagination when <code>query.$limit</code> is -1 or ‚Äò-1‚Äô.</li>
<li><code>discardQuery</code>, <code>keep</code>, <code>keepQuery</code> - See Migration below.</li>
<li><code>makeCallingParams</code> utility - Help construct <code>context.params</code> when calling services within hooks.</li>
<li><code>required</code> - Check selected fields exist and are not falsey. Numeric 0 is acceptable.</li>
<li><code>runParallel</code> - Run a hook in parallel to the other hooks and the service call.</li>
</ul>
</li>
<li><p>Enhancements to existing hooks.</p>
<ul>
<li><code>debug</code> now displays <code>context.params</code> property names and displays the values of selected ones.</li>
<li><code>preventChanges</code> can now optionally remove unacceptable changes instead of throwing.</li>
</ul>
</li>
</ul>
<!--=============================================================================================-->
<h2 id="Migrating-from-Auk-to-Buzzard"><a href="#Migrating-from-Auk-to-Buzzard" class="headerlink" title="Migrating from Auk to Buzzard"></a>Migrating from Auk to Buzzard</h2><p>These changes may affect your projects when you switch from this repo‚Äôs last Feathers <em>Auk</em> version (v3.10.0) to its first Feathers <em>Buzzard</em> version (v4.0.0).</p>
<ul>
<li><p>These hooks are deprecated and will be removed in the next FeathersJS version <em>Crow</em>.</p>
<ul>
<li>Deprecated <code>pluck</code> in favor of <code>keep</code>, e.g. <code>iff(isProvider(&#39;external&#39;),</code> <code>keep(...fieldNames))</code>. This deprecates the last hook with unexpected internal ‚Äúmagic‚Äù. <strong>Be careful!</strong></li>
<li>Deprecated <code>pluckQuery</code> in favor of <code>keepQuery</code> for naming consistency.</li>
<li>Deprecated <code>removeQuery</code> in favor of <code>discardQuery</code> for naming consistency.</li>
<li>Deprecated <code>client</code> in favor of <code>paramsFromClient</code> for naming consistency.</li>
<li>Deprecated <code>createdAt</code> and <code>updatedAt</code> in favor of <code>setNow</code>.</li>
<li>Deprecated <code>callbackToPromise</code> in favor of Node‚Äôs <code>require(&#39;util&#39;).promisify</code>.</li>
<li>Deprecated <code>promiseToCallback</code> as there‚Äôs probably no need for it anymore.</li>
</ul>
</li>
<li><p>Removed hooks previously deprecated in <em>Auk</em>.:</p>
<ul>
<li>Removed support for the deprecated legacy syntax in <code>populate</code>.</li>
<li>Removed <code>remove</code>.</li>
</ul>
</li>
<li><p>The license now includes a clause which prevents the repo from being published on npm under another name. That is its only purpose; you can otherwise continue using the repo just as you have in the past.</p>
</li>
</ul>
<!--=============================================================================================-->
<h2 id="whats-new">What‚Äôs New</h2>

<p>The details are at <a href="https://github.com/feathers-plus/feathers-hooks-common/blob/master/CHANGELOG.md" target="_blank" rel="noopener">Changelog.</a></p>
<h4 id="February-2018"><a href="#February-2018" class="headerlink" title="February 2018"></a>February 2018</h4><ul>
<li>Buzzard version published as <strong>npm</strong> as v4.x.x.</li>
<li><code>alterItems</code> may now optionally return the items rather than modifying them in place.</li>
<li><code>disableMultiItemCreate</code> introduced. It prevents a service from creating multiple records in one service call.</li>
<li><code>mongoKeys</code> introduced for MongoDB services. Its wraps foreign keys found in <code>query</code> in ObjectID.</li>
</ul>
<h4 id="March-2018"><a href="#March-2018" class="headerlink" title="March 2018"></a>March 2018</h4><ul>
<li>Documented how to <a href="guide.html#Making-Hook-Params-Dynamic">make any hook parameter dynamic</a>.</li>
<li><code>skipRemainingHooks</code> introduced. It conditionally skips running all remaining hooks.</li>
<li><code>actOnDispatch(...hooks)</code> and <code>actOnDefault(...hooks)</code>. You can use them to run most common hooks, and any hooks using <code>getItems</code> and <code>replaceItems</code> so they mutate <code>context.dispatch</code> rather than <code>context.data</code> or <code>context.result</code>.</li>
<li><code>mongoKeys</code> can now be used with any type of service call, not just <code>find</code>.</li>
</ul>
<h4 id="June-2018"><a href="#June-2018" class="headerlink" title="June 2018"></a>June 2018</h4><ul>
<li><code>discard</code> and <code>keep</code> support records which are <code>null</code>.</li>
<li>A new, more convenient signature for async functions has been introduced for <code>alterItems</code>.</li>
<li><code>callingParams</code> and <code>callingParamsDefaults</code> utility functions added. <code>callingParams</code> should now be used rather than <code>makeCallingParams</code>.</li>
</ul>
<h4 id="July-2018"><a href="#July-2018" class="headerlink" title="July 2018"></a>July 2018</h4><ul>
<li><code>softDelete2</code> is a notable improvement over <code>softDelete</code>. It cooperates well with authentication and the <code>restrictToOwner</code> hook. Custom functions are supported for its probing get and removal patch calls. Hooks defined on these call methods will, by default,not be executed to eliminate interactions.</li>
</ul>
<h4 id="Auguset-2018"><a href="#Auguset-2018" class="headerlink" title="Auguset 2018"></a>Auguset 2018</h4><ul>
<li><code>keepInArray</code> For an array of objects, keeps selected field in each object. Contributed by Dekel Barzilay (dekelev).</li>
</ul>

  
    <div class="guide-links">
      <!-- link to previous page -->
      
        <span>‚Üê <a href="/v1/feathers-hooks-common/guide.html">Guide</a></span>
      
      <!-- link to next page -->
      
    </div>
  
  <div class="footer">

    Caught a mistake or want to contribute to the documentation?
    <a href="https://github.com/feathers-plus/docs/blob/master/source/v1/feathers-hooks-common/index.md" target="_blank">
      Edit this page on Github!
    </a>
  </div>
</div>

        
      </div>
      <script src="/js/smooth-scroll.min.js"></script>
    

    <!-- main custom script for sidebars, version selects etc. ------------------------------------>
    <script src="/js/css.escape.js"></script>
    <script src="/js/common.js"></script>

    <!-- search ----------------------------------------------------------------------------------->
    <!--
    <link href="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/search.css">
    <script src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script>
    [
      '#search-query-nav',
      '#search-query-sidebar',
      '#search-query-menu'
    ].forEach(function (selector) {
      if (!document.querySelector(selector)) return
      // search index defaults to v2
      var match = window.location.pathname.match(/^\/(v\d+)/)
      var version = match ? match[1] : 'v2'
      docsearch({
      appId: 'BH4D9OD16A',
      apiKey: '85cc3221c9f23bfbaa4e3913dd7625ea',
      indexName: 'vuejs',
      inputSelector: selector,
      algoliaOptions: { facetFilters: ["version:" + version] }
      })
    })
    </script>
    -->

    <!-- fastclick -------------------------------------------------------------------------------->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      FastClick.attach(document.body)
    }, false)
    </script>
  </body>
</html>
